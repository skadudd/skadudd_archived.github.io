<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="ê²€ìƒ‰ê´‘ê³ ,ë„¤ì´ë²„ê²€ìƒ‰ê´‘ê³ API,í¼í¬ë¨¼ìŠ¤ë§ˆì¼€íŒ…">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ê³ í†µë°›ëŠ” ë§ˆì¼€í„°ë¥¼ ìœ„í•œ ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  API í™œìš©ë²• 1 GA ë¹„ìš©ë°ì´í„° ì‰½ê²Œ ì¶”ê°€í•˜ê¸° | Data Archive Doyle</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="ê³ í†µë°›ëŠ” ë§ˆì¼€í„°ë¥¼ ìœ„í•œ ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  API í™œìš©ë²• 1 GA ë¹„ìš©ë°ì´í„° ì‰½ê²Œ ì¶”ê°€í•˜ê¸°" />
<meta name="author" content="Doyle" />
<meta property="og:locale" content="ko_KR" />
<meta name="description" content="ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  APIë¥¼ í™œìš©í•˜ì—¬ ì†ì‰½ê²Œ ë¦¬í¬íŒ…ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. !" />
<meta property="og:description" content="ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  APIë¥¼ í™œìš©í•˜ì—¬ ì†ì‰½ê²Œ ë¦¬í¬íŒ…ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. !" />
<link rel="canonical" href="http://localhost:4000/articles/2021/01/13/%EB%B0%B1%EC%A4%80-11656-%EC%A0%91%EB%AF%B8%EC%82%AC-%EB%B0%B0%EC%97%B4-java-%EB%AC%B8%EC%A0%9C%ED%92%80%EC%9D%B4-%EB%B3%B5%EC%82%AC%EB%B3%B8-3" />
<meta property="og:url" content="http://localhost:4000/articles/2021/01/13/%EB%B0%B1%EC%A4%80-11656-%EC%A0%91%EB%AF%B8%EC%82%AC-%EB%B0%B0%EC%97%B4-java-%EB%AC%B8%EC%A0%9C%ED%92%80%EC%9D%B4-%EB%B3%B5%EC%82%AC%EB%B3%B8-3" />
<meta property="og:site_name" content="Data Archive Doyle" />
<meta property="og:image" content="http://localhost:4000/assets/images/posts/common/25673_21329_0.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-13T15:00:00+09:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/posts/common/25673_21329_0.jpg" />
<meta property="twitter:title" content="ê³ í†µë°›ëŠ” ë§ˆì¼€í„°ë¥¼ ìœ„í•œ ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  API í™œìš©ë²• 1 GA ë¹„ìš©ë°ì´í„° ì‰½ê²Œ ì¶”ê°€í•˜ê¸°" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Doyle"},"dateModified":"2021-01-13T15:00:00+09:00","datePublished":"2021-01-13T15:00:00+09:00","description":"ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  APIë¥¼ í™œìš©í•˜ì—¬ ì†ì‰½ê²Œ ë¦¬í¬íŒ…ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. !","headline":"ê³ í†µë°›ëŠ” ë§ˆì¼€í„°ë¥¼ ìœ„í•œ ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  API í™œìš©ë²• 1 GA ë¹„ìš©ë°ì´í„° ì‰½ê²Œ ì¶”ê°€í•˜ê¸°","image":"http://localhost:4000/assets/images/posts/common/25673_21329_0.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/articles/2021/01/13/%EB%B0%B1%EC%A4%80-11656-%EC%A0%91%EB%AF%B8%EC%82%AC-%EB%B0%B0%EC%97%B4-java-%EB%AC%B8%EC%A0%9C%ED%92%80%EC%9D%B4-%EB%B3%B5%EC%82%AC%EB%B3%B8-3"},"url":"http://localhost:4000/articles/2021/01/13/%EB%B0%B1%EC%A4%80-11656-%EC%A0%91%EB%AF%B8%EC%82%AC-%EB%B0%B0%EC%97%B4-java-%EB%AC%B8%EC%A0%9C%ED%92%80%EC%9D%B4-%EB%B3%B5%EC%82%AC%EB%B3%B8-3"}</script>
<!-- End Jekyll SEO tag -->

  
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
              // ...options...
          });
      });
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/articles/2021/01/13/%EB%B0%B1%EC%A4%80-11656-%EC%A0%91%EB%AF%B8%EC%82%AC-%EB%B0%B0%EC%97%B4-java-%EB%AC%B8%EC%A0%9C%ED%92%80%EC%9D%B4-%EB%B3%B5%EC%82%AC%EB%B3%B8-3">
  <link rel="alternate" type="application/rss+xml" title="Data Archive | Doyle" href="http://localhost:4000/feed.xml">
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">

  <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-UA-185737211-1"></script> -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-185737211-1');
  </script>
</head>

  
  <body>
    <header class="site-header">

  <div class="wrapper">
    <a class="site-title" style="text-decoration: none" href="/">
<!--       &lt;:]{%&gt; == []{} -->
<!--      &lt;<span style="color: #ff5400;">daegikim</span>.github.io/&gt;-->
        Doyle, Growth Hacker
        <span style="display: inline-block" class=" animated bounceIn">ğŸš€</span>
    </a>
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
           
          <a class="page-link" href="/about">About</a>
          
          <a class="page-link" href="/">Blog</a>
                                               
      </div>
    </nav>
  </div>
</header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/math...">
    </script>

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">ê³ í†µë°›ëŠ” ë§ˆì¼€í„°ë¥¼ ìœ„í•œ ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  API í™œìš©ë²• 1 | GA ë¹„ìš©ë°ì´í„° ì‰½ê²Œ ì¶”ê°€í•˜ê¸°</h1>
    <p class="post-meta">
      <span class="left">
        <time datetime="2021-01-13T15:00:00+09:00" itemprop="datePublished">Jan 13, 2021</time>
       <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Doyle</span></span>
      </span>
      <span class="right">
        <span class="post-author-image" style="background-image:url(/assets/images/conan.png);"></span>
      </span>
    </p>
  </header>
  <div class="post-content" itemprop="articleBody">
    <p>ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  APIë¥¼ í™œìš©í•˜ì—¬ ì†ì‰½ê²Œ ë¦¬í¬íŒ…ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. !</p>

<!--more-->
<pre><code class="language-python">import os
import time
import shutil
import random
import json
import glob
import requests
import signaturehelper
import pandas as pd
from pandas import DataFrame
from pathlib import Path
import csv
from dateutil import rrule
from datetime import datetime, timedelta
from dateutil.parser import *

BASE_URL = 'https://api.naver.com'
API_KEY = 'API Key'
SECRET_KEY = 'Secret key'
CUSTOMER_ID = 'Customer ID'
input_file = '../DB_for_GA_naver/'
output_file = '../DB_of_naver_combined/'
campaignList = ['cmp-a001-01-000000003407889',
                'cmp-a001-01-000000003407888',
                'cmp-a001-01-000000003645640',
                'cmp-a001-01-000000003605317',
                'cmp-a001-01-000000003711127',
                'cmp-a001-01-000000003711121',
                'cmp-a001-01-000000003707633',
                'cmp-a001-01-000000003707625'
                ]

#1. GET Summary Report per multiple entities 
input_start_date = input('ë³´ê³  ì‹œì‘ ë‚ ì§œ : ')
input_end_date = input('ë³´ê³  ì¢…ë£Œ ë‚ ì§œ : ')

start_date = parse(input_start_date)
end_date = parse(input_end_date)

#import key
def get_header(method, uri, api_key, secret_key, customer_id):
    timestamp = str(round(time.time() * 1000))
    signature = signaturehelper.Signature.generate(timestamp, method, uri, SECRET_KEY)
    return {'Content-Type': 'application/json; charset=UTF-8', 'X-Timestamp': timestamp, 'X-API-KEY': API_KEY, 'X-Customer': str(CUSTOMER_ID), 'X-Signature': signature}

def iterate_request():
    for dt in rrule.rrule(rrule.DAILY, dtstart=start_date, until=end_date):
        date = str(dt.date())
        try : 
            data_to_csv(date)
        except : 
            print(f'no data in {date}')

#requested data to csv
def data_to_csv(date):
    for v in campaignList :
        uri = '/stats'
        method = 'GET'
        rangeOftime = {"since" : date, "until" : date}
        json_range_of_time = json.dumps(rangeOftime, indent=2)
        stat_ids = [v]
        params={
            'ids': stat_ids,
            'fields': '["clkCnt","impCnt","salesAmt"]', 
            'timeRange': json_range_of_time }
        r = requests.get(BASE_URL + uri, params, headers=get_header(method, uri, API_KEY, SECRET_KEY, CUSTOMER_ID))
        # print("response status_code = {}".format(r.status_code))
        # print("response body = {}".format(r.json()))
        json_data = json.loads(r.text)

        if(len(json_data['data']) == 0) :
            print(f'no data in {v} on {date}')
            continue
        
        data = json_data['data'][0]

        print(v)
        print('campaign : ',data)
        striped_date = date.replace('-','')
        medium = 'cpc'
        source = 'search.naver.com'
        clkCnt = data['clkCnt']
        impCnt = data['impCnt']
        salesAmt = data['salesAmt']
        campaign = 0

        if(v == 'cmp-a001-01-000000003407889') :
            campaign = 'NSA_cnc_contents'
        elif(v == 'cmp-a001-01-000000003407888') :
            campaign = 'NSA_cnc'
        elif(v == 'cmp-a001-01-000000003707625') :
            campaign = 'NSA_cnc_Mobile'
        elif(v == 'cmp-a001-01-000000003645640') :
            campaign = 'NSA_3dp'
        elif(v == 'cmp-a001-01-000000003707633') :
            campaign = 'NSA_3dp_Mobile'
        elif(v == 'cmp-a001-01-000000003711121') :
            campaign = 'NSA_INJ'
        elif(v == 'cmp-a001-01-000000003711127') : 
            campaign = 'NSA_INJ_Mobile'
        elif(v == 'cmp-a001-01-000000003605317') :
            campaign = 'NSA_Brand'

        newRow = [striped_date, medium, source, clkCnt, salesAmt, impCnt, campaign]
        ad_data = {'ga:date':[striped_date], 'ga:medium':[medium], 'ga:source':[source], 'ga:adClicks':[clkCnt], 'ga:adCost':[salesAmt], 'ga:impressions':[impCnt], 'ga:campaign':[campaign] }
        df = pd.DataFrame(data=ad_data)
        
        df.to_csv(Path(input_file, f'{striped_date} {source} {campaign}.csv'), index=False)

def merge_csv(): 
    allFile_list = glob.glob(os.path.join(input_file, '*.csv'))
    all_data = []

    for file in allFile_list:
        df = pd.read_csv(file)
        all_data.append(df)

    data_combine = pd.concat(all_data, axis=0, ignore_index=True)
    data_combine.to_csv(Path(output_file, f'{start_date.date()}_{end_date.date()}_combined.csv'), index=False )

def removeAllFile():
    if os.path.exists(input_file):
        for file in os.scandir(input_file):
            os.remove(file.path)
        return 'input í´ë” ì‚­ì œ ì™„ë£Œ'
    else :
        return 'input í´ë” ì—ëŸ¬'

def init():
    iterate_request()
    merge_csv()
    removeAllFile()

init()
</code></pre>
<p><code>.python</code> ë°±í‹±</p>

  </div>
</article>
<!-- 

<div id="disqus_thread"></div>
<script>
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://daegikim.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 -->

      </div>
    </div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="footer-heading">
      copyrignt
      <span style="display: inline-block; vertical-align: middle; transform: rotate(180deg)">&copy;</span>
      all rights reserved
    </div>
    <a href="https://github.com/skadudd"><i class="icon ion-logo-github"></i></a>
    <!-- <a href="https://www.linkedin.com/in/daegi-kim-6b23045b"><i class="icon ion-logo-linkedin"></i></a> -->
    <a href="https://www.instagram.com/naamyoung/"><i class="icon ion-logo-instagram"></i></a>
  </div>
</footer>

  </body>
</html>