<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="í†µê³„,ìƒì¡´ë¶„ì„">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ìƒì¡´ ë¶„ì„ - ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • [íŒŒì´ì¬ ì˜ˆì œ] | Data Archive Doyle</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="ìƒì¡´ ë¶„ì„ - ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • [íŒŒì´ì¬ ì˜ˆì œ]" />
<meta name="author" content="Doyle" />
<meta property="og:locale" content="ko_KR" />
<meta name="description" content="ì¹´í”Œë€ ë§ˆì´ì–´ í•˜ë“œì½”ë”© ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ê°•ì•„ì§€ ë³´í˜¸ì†Œë¥¼ ì˜ˆì‹œë¡œ ì‚¬ìš©í•œë‹¤. ê°•ì•„ì§€ ë³´í˜¸ì†Œì—ëŠ” ìƒˆë¡œìš´ ê°•ì•„ì§€ê°€ ì…ì†Œí•˜ê³ , ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì´ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ ê°•ì•„ì§€ê°€ ë³´í˜¸ì†Œì— ë‚¨ì•„ìˆëŠ” ê¸°ê°„ì„ ìƒì¡´ê¸°ê°„ìœ¼ë¡œ, ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì„ ìœ„í—˜ìœ¼ë¡œ ê°„ì£¼í•œë‹¤. ë°ì´í„° ì…‹ êµ¬ì„± ê°€ìƒì˜ ê°•ì•„ì§€ ë³´í˜¸ì†Œ ë°ì´í„° êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ë‹¤. start : ë³´í˜¸ì†Œ ì…ì†Œ ì‹œê°„ end : ì…ì–‘ ì‚¬ê±´ ë°œìƒ ì‹œê°„. 9ëŠ” ê´€ì¸¡ ì¢…ë£Œ ì‹œì ì´ë¯€ë¡œ í•´ë‹¹ ì»¬ëŸ¼ì´ 9ì¼ ê²½ìš° cencored status : 1ì¼ ê²½ìš° ì‚¬ê±´ ë°œìƒ, 0ì¼ ê²½ìš° ì‚¬ê±´ ë¯¸ë°œìƒ import pandas as pd import numpy as np import matplotlib.pyplot as plt obs = pd.DataFrame() obs[&#39;start&#39;] = 0,1,2,2,4,6,7 obs[&#39;end&#39;] = 5,2,6,9,9,8,9 obs[&#39;status&#39;] = 1,1,1,0,0,1,0 obs start end status 0 0 5 1 1 1 2 1 2 2 6 1 3 2 9 0 4 4 9 0 5 6 8 1 6 7 9 0 A. ë ˆì½”ë“œ plot def plot_lifelines(obs): for y,row in obs.iterrows(): start = row[&#39;start&#39;] end = row[&#39;end&#39;] status = row[&#39;status&#39;] if status == 0: plt.hlines(y,start,end,color=&#39;C0&#39;) else : plt.hlines(y,start,end,color=&#39;C1&#39;) plt.plot(end,y,marker=&#39;o&#39;,color=&#39;C1&#39;) plt.xlabel(&#39;Time (weeks)&#39;) plt.ylabel(&#39;Dog Index&#39;) plt.gca().invert_yaxis() plot_lifelines(obs) ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ ë‘ê°€ì§€ ì•„ì´ë””ì–´ì—ì„œ ì‹œì‘í•œë‹¤. ë ˆì½”ë“œì˜ ì‹œì‘ì§€ì ì„ ë¬´ì‹œí•˜ê³  duration timeë§Œì„ ê³ ë ¤í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ë¥¼ ì¶”ì •í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ëŠ” ê° ê¸°ê°„ ë‚´ ë°œìƒí•œ ì‚¬ê±´ì„ ìœ„í—˜ì— ì²˜í•œ ì´ ë ˆì½”ë“œ ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ ë„ì¶œí•œë‹¤. A. Duration time ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì„¸íŠ¸ ìƒì„± duration = obs[&#39;end&#39;] - obs[&#39;start&#39;] shifted = obs.copy() shifted[&#39;start&#39;] = 0 shifted[&#39;end&#39;] = duration plot_lifelines(shifted) plt.xlabel(&#39;Duration (week)&#39;); B. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ At Risk ë„ì¶œ At RiskëŠ” íŠ¹ì • ê¸°ê°„ë™ì•ˆ ì‚¬ê±´ì´ ë°œìƒí•˜ì§€ ì•Šì•˜ê±°ë‚˜ ì ˆë‹¨ë˜ì§€ ì•Šì€ ë ˆì½”ë“œì˜ ìˆ˜ë¥¼ ëœ»í•œë‹¤. ì•„ë˜ ì½”ë“œëŠ” numpyì˜ meshgrid í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ê±´ì´ ë°œìƒí•œ Duration Timeê³¼ ê° ë ˆì½”ë“œì˜ end ì‹œì ì„ ê°ê° ë¹„êµí•œë‹¤. ì‚¬ê±´ì´ ë°œìƒí•œ $Duration Time_i$ ë³´ë‹¤ ë ˆì½”ë“œì˜ $end_i$ ì‹œì ì´ ê°™ê±°ë‚˜ í¬ë‹¤ë©´, $DurationTime_i$ ë‚´ì— ìƒì¡´í•œ ë ˆì½”ë“œì´ë‹¤. ì¦‰, ì‚¬ê±´ì´ ë°œìƒí•œ ê°ê°ì˜ Duration Time ë‚´ ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œë“¤ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤. ts = duration.unique() ts.sort() ts â‡’ array([1, 2, 4, 5, 7]) E,T = np.meshgrid(shifted[&#39;end&#39;],ts) E array([[5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2]]) at_risk = (T &lt;= E).sum(axis=1) at_risk array([7, 6, 4, 3, 1]) T&lt;br [&lt;br&gt; [1, 1, 1, 1, 1, 1, 1],&lt;br&gt; [2, 2, 2, 2, 2, 2, 2],&lt;br&gt; [4, 4, 4, 4, 4, 4, 4],&lt;br&gt; [5, 5, 5, 5, 5, 5, 5],&lt;br&gt; [7, 7, 7, 7, 7, 7, 7]&lt;br&gt; ]&lt;br&gt; &lt;= E&lt;br&gt; [&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2]&lt;br&gt; ]&lt;br&gt; This results in a boolean array: [&lt;br&gt; [True, True, True, True, True, True, True],&lt;br&gt; [True, False, True, True, True, True, True],&lt;br&gt; [True, False, True, True, True, False, False],&lt;br&gt; [True, False, False, True, True, False, False],&lt;br&gt; [False, False, False, True, False, False, False]&lt;br&gt; ]&lt;br&gt; [7, 6, 4, 3, 1] This gives us the number of individuals who are considered &quot;at risk&quot; for each time point. C. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ ì‚¬ê±´ ë°œìƒ ìˆ˜ ë„ì¶œ ê° t(Duration Time)ë§ˆë‹¤ ì…ì–‘ì´ ë°œìƒí•œ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤. adopted = pd.Series(0,index=ts) for t in ts: k = (shifted[&#39;status&#39;]==1) &amp; (t == shifted[&#39;end&#39;]) adopted[t] = k.sum() adopted 1 1 2 1 4 1 5 1 7 0 dtype: int64 d = dict(adopted=adopted, at_risk=at_risk) df= pd.DataFrame(d,index=ts) df adopted at_risk 1 1 7 2 1 6 4 1 4 5 1 3 7 0 1 D. ìœ„í—˜í•¨ìˆ˜ ê³„ì‚°. ì‚¬ê±´ë°œìƒ ìˆ˜ / ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œ ìˆ˜ df[&#39;hazard&#39;] = df[&#39;adopted&#39;]/df[&#39;at_risk&#39;] df adopted at_risk hazard 1 1 7 0.142857 2 1 6 0.166667 4 1 4 0.250000 5 1 3 0.333333 7 0 1 0.000000 ìƒì¡´í•¨ìˆ˜ ê³„ì‚° ìœ„ì—ì„œ ê³„ì‚°í•œ ìœ„í—˜í•¨ìˆ˜ëŠ” íŠ¹ì • ê¸°ê°„ì— ì‚¬ê±´ì´ ë°œìƒí•  í™•ë¥ ì´ë‹¤. ì´ ì¼€ì´ìŠ¤ì—ì„œ ì‚¬ê±´ì€ ì…ì–‘ì´ë‹¤. ë”°ë¼ì„œ ë°˜ëŒ€ì˜ ì¼€ì´ìŠ¤ëŠ” ì…ì–‘ì´ ë˜ì§€ ì•Šì€ ìƒì¡´ì´ë©°, ì´ ìƒì¡´ì˜ ëˆ„ì ê³±ì´ ìƒì¡´í•¨ìˆ˜ê°€ ëœë‹¤. df[&#39;surv&#39;] = (1 - df[&#39;hazard&#39;]).cumprod() df adopted at_risk hazard surv 1 1 7 0.142857 0.857143 2 1 6 0.166667 0.714286 4 1 4 0.250000 0.535714 5 1 3 0.333333 0.357143 7 0 1 0.000000 0.357143 ëˆ„ì  ë¶„í¬í•¨ìˆ˜ëŠ” 1 - ìƒì¡´í•¨ìˆ˜ì´ë‹¤. df[&#39;cdf&#39;] = 1 - df[&#39;surv&#39;] df adopted at_risk hazard surv cdf 1 1 7 0.142857 0.857143 0.142857 2 1 6 0.166667 0.714286 0.285714 4 1 4 0.250000 0.535714 0.464286 5 1 3 0.333333 0.357143 0.642857 7 0 1 0.000000 0.357143 0.642857 í™•ë¥  ì§ˆëŸ‰í•¨ìˆ˜ëŠ” cdfì˜ ë³€í™”ëŸ‰ì´ë‹¤ df[&#39;pdf&#39;] = np.diff(df[&#39;cdf&#39;],prepend=0) df adopted at_risk hazard surv cdf pdf 1 1 7 0.142857 0.857143 0.142857 0.142857 2 1 6 0.166667 0.714286 0.285714 0.142857 4 1 4 0.250000 0.535714 0.464286 0.178571 5 1 3 0.333333 0.357143 0.642857 0.178571 7 0 1 0.000000 0.357143 0.642857 0.000000 ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ ì¹´í”Œë€ë§ˆì´ì–´ ì¶”ì • ìœ„ì˜ í•˜ë“œì½”ë”©ìœ¼ë¡œ êµ¬í˜„í•œ ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ lifelines ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ë©´ ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. from lifelines import KaplanMeierFitter kmf = KaplanMeierFitter() T = shifted[&#39;end&#39;] E = shifted[&#39;status&#39;] kmf.fit(T,E) &lt;lifelines.KaplanMeierFitter:&quot;KM_estimate&quot;, fitted with 7 total observations, 3 right-censored observations&gt; kmf.survival_function_ KM_estimate timeline 0.0 1.000000 1.0 0.857143 2.0 0.714286 4.0 0.535714 5.0 0.357143 7.0 0.357143 ìƒì¡´í•¨ìˆ˜ì˜ confidence intervalì„ êµ¬í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ì˜ˆì œì˜ ìë£Œê°€ ë§¤ìš° ì‘ê¸°ì— CIëŠ” ìƒë‹¹íˆ ë„“ë‹¤. ci = kmf.confidence_interval_survival_function_ ci KM_estimate_lower_0.95 KM_estimate_upper_0.95 0.0 1.000000 1.000000 1.0 0.334054 0.978561 2.0 0.258154 0.919797 4.0 0.131988 0.824997 5.0 0.051977 0.698713 7.0 0.051977 0.698713 ts = ci.index low, high = np.transpose(ci.values) plt.fill_between(ts,low,high,color=&#39;grey&#39;,alpha=0.3) kmf.survival_function_.plot(ax=plt.gca()) plt.ylabel(&#39;Survival function&#39;) kmf.median_survival_time_ 5.0 ì¹´í”Œë€ ë§ˆì´ì–´ ê³¡ì„  í•´ì„ ìƒì¡´ ê³¡ì„ ì„ í†µí•´ ë‹¤ì–‘í•œ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë‹¤. í•´ë‹¹ ê°•ì•„ì§€ ë³´í˜¸ì†Œì˜ ì¤‘ìœ„ ìƒì¡´ê°’ì€ 5. ë”°ë¼ì„œ ì…ì†Œ í›„ 5ì£¼ì§¸ 50%ì˜ ì…ì–‘ì´ ë°œìƒí•œë‹¤. ê³µê°„ í™œìš© ìµœì í™”ë¥¼ ìœ„í•´ ì–´ëŠ ì£¼ê¸°ë¡œ ì‹ ê·œ ì…ì†Œê²¬ì„ ë°›ì•„ì•¼ í• ì§€ ê²°ì •í•  ìˆ˜ ìˆë‹¤. ë˜í•œ, ì…ì–‘ ì‚¬ê±´ ë°œìƒì‹œ ë§¤ì¶œì´ ë°œìƒí•œë‹¤ë©´, ìƒì¡´ê¸°ê°„ê³¼ ë§¤ì¶œì„ ê³±í•˜ì—¬ LTVì™€ ì˜ˆìƒ ë§¤ì¶œì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤." />
<meta property="og:description" content="ì¹´í”Œë€ ë§ˆì´ì–´ í•˜ë“œì½”ë”© ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ê°•ì•„ì§€ ë³´í˜¸ì†Œë¥¼ ì˜ˆì‹œë¡œ ì‚¬ìš©í•œë‹¤. ê°•ì•„ì§€ ë³´í˜¸ì†Œì—ëŠ” ìƒˆë¡œìš´ ê°•ì•„ì§€ê°€ ì…ì†Œí•˜ê³ , ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì´ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ ê°•ì•„ì§€ê°€ ë³´í˜¸ì†Œì— ë‚¨ì•„ìˆëŠ” ê¸°ê°„ì„ ìƒì¡´ê¸°ê°„ìœ¼ë¡œ, ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì„ ìœ„í—˜ìœ¼ë¡œ ê°„ì£¼í•œë‹¤. ë°ì´í„° ì…‹ êµ¬ì„± ê°€ìƒì˜ ê°•ì•„ì§€ ë³´í˜¸ì†Œ ë°ì´í„° êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ë‹¤. start : ë³´í˜¸ì†Œ ì…ì†Œ ì‹œê°„ end : ì…ì–‘ ì‚¬ê±´ ë°œìƒ ì‹œê°„. 9ëŠ” ê´€ì¸¡ ì¢…ë£Œ ì‹œì ì´ë¯€ë¡œ í•´ë‹¹ ì»¬ëŸ¼ì´ 9ì¼ ê²½ìš° cencored status : 1ì¼ ê²½ìš° ì‚¬ê±´ ë°œìƒ, 0ì¼ ê²½ìš° ì‚¬ê±´ ë¯¸ë°œìƒ import pandas as pd import numpy as np import matplotlib.pyplot as plt obs = pd.DataFrame() obs[&#39;start&#39;] = 0,1,2,2,4,6,7 obs[&#39;end&#39;] = 5,2,6,9,9,8,9 obs[&#39;status&#39;] = 1,1,1,0,0,1,0 obs start end status 0 0 5 1 1 1 2 1 2 2 6 1 3 2 9 0 4 4 9 0 5 6 8 1 6 7 9 0 A. ë ˆì½”ë“œ plot def plot_lifelines(obs): for y,row in obs.iterrows(): start = row[&#39;start&#39;] end = row[&#39;end&#39;] status = row[&#39;status&#39;] if status == 0: plt.hlines(y,start,end,color=&#39;C0&#39;) else : plt.hlines(y,start,end,color=&#39;C1&#39;) plt.plot(end,y,marker=&#39;o&#39;,color=&#39;C1&#39;) plt.xlabel(&#39;Time (weeks)&#39;) plt.ylabel(&#39;Dog Index&#39;) plt.gca().invert_yaxis() plot_lifelines(obs) ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ ë‘ê°€ì§€ ì•„ì´ë””ì–´ì—ì„œ ì‹œì‘í•œë‹¤. ë ˆì½”ë“œì˜ ì‹œì‘ì§€ì ì„ ë¬´ì‹œí•˜ê³  duration timeë§Œì„ ê³ ë ¤í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ë¥¼ ì¶”ì •í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ëŠ” ê° ê¸°ê°„ ë‚´ ë°œìƒí•œ ì‚¬ê±´ì„ ìœ„í—˜ì— ì²˜í•œ ì´ ë ˆì½”ë“œ ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ ë„ì¶œí•œë‹¤. A. Duration time ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì„¸íŠ¸ ìƒì„± duration = obs[&#39;end&#39;] - obs[&#39;start&#39;] shifted = obs.copy() shifted[&#39;start&#39;] = 0 shifted[&#39;end&#39;] = duration plot_lifelines(shifted) plt.xlabel(&#39;Duration (week)&#39;); B. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ At Risk ë„ì¶œ At RiskëŠ” íŠ¹ì • ê¸°ê°„ë™ì•ˆ ì‚¬ê±´ì´ ë°œìƒí•˜ì§€ ì•Šì•˜ê±°ë‚˜ ì ˆë‹¨ë˜ì§€ ì•Šì€ ë ˆì½”ë“œì˜ ìˆ˜ë¥¼ ëœ»í•œë‹¤. ì•„ë˜ ì½”ë“œëŠ” numpyì˜ meshgrid í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ê±´ì´ ë°œìƒí•œ Duration Timeê³¼ ê° ë ˆì½”ë“œì˜ end ì‹œì ì„ ê°ê° ë¹„êµí•œë‹¤. ì‚¬ê±´ì´ ë°œìƒí•œ $Duration Time_i$ ë³´ë‹¤ ë ˆì½”ë“œì˜ $end_i$ ì‹œì ì´ ê°™ê±°ë‚˜ í¬ë‹¤ë©´, $DurationTime_i$ ë‚´ì— ìƒì¡´í•œ ë ˆì½”ë“œì´ë‹¤. ì¦‰, ì‚¬ê±´ì´ ë°œìƒí•œ ê°ê°ì˜ Duration Time ë‚´ ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œë“¤ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤. ts = duration.unique() ts.sort() ts â‡’ array([1, 2, 4, 5, 7]) E,T = np.meshgrid(shifted[&#39;end&#39;],ts) E array([[5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2]]) at_risk = (T &lt;= E).sum(axis=1) at_risk array([7, 6, 4, 3, 1]) T&lt;br [&lt;br&gt; [1, 1, 1, 1, 1, 1, 1],&lt;br&gt; [2, 2, 2, 2, 2, 2, 2],&lt;br&gt; [4, 4, 4, 4, 4, 4, 4],&lt;br&gt; [5, 5, 5, 5, 5, 5, 5],&lt;br&gt; [7, 7, 7, 7, 7, 7, 7]&lt;br&gt; ]&lt;br&gt; &lt;= E&lt;br&gt; [&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2]&lt;br&gt; ]&lt;br&gt; This results in a boolean array: [&lt;br&gt; [True, True, True, True, True, True, True],&lt;br&gt; [True, False, True, True, True, True, True],&lt;br&gt; [True, False, True, True, True, False, False],&lt;br&gt; [True, False, False, True, True, False, False],&lt;br&gt; [False, False, False, True, False, False, False]&lt;br&gt; ]&lt;br&gt; [7, 6, 4, 3, 1] This gives us the number of individuals who are considered &quot;at risk&quot; for each time point. C. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ ì‚¬ê±´ ë°œìƒ ìˆ˜ ë„ì¶œ ê° t(Duration Time)ë§ˆë‹¤ ì…ì–‘ì´ ë°œìƒí•œ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤. adopted = pd.Series(0,index=ts) for t in ts: k = (shifted[&#39;status&#39;]==1) &amp; (t == shifted[&#39;end&#39;]) adopted[t] = k.sum() adopted 1 1 2 1 4 1 5 1 7 0 dtype: int64 d = dict(adopted=adopted, at_risk=at_risk) df= pd.DataFrame(d,index=ts) df adopted at_risk 1 1 7 2 1 6 4 1 4 5 1 3 7 0 1 D. ìœ„í—˜í•¨ìˆ˜ ê³„ì‚°. ì‚¬ê±´ë°œìƒ ìˆ˜ / ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œ ìˆ˜ df[&#39;hazard&#39;] = df[&#39;adopted&#39;]/df[&#39;at_risk&#39;] df adopted at_risk hazard 1 1 7 0.142857 2 1 6 0.166667 4 1 4 0.250000 5 1 3 0.333333 7 0 1 0.000000 ìƒì¡´í•¨ìˆ˜ ê³„ì‚° ìœ„ì—ì„œ ê³„ì‚°í•œ ìœ„í—˜í•¨ìˆ˜ëŠ” íŠ¹ì • ê¸°ê°„ì— ì‚¬ê±´ì´ ë°œìƒí•  í™•ë¥ ì´ë‹¤. ì´ ì¼€ì´ìŠ¤ì—ì„œ ì‚¬ê±´ì€ ì…ì–‘ì´ë‹¤. ë”°ë¼ì„œ ë°˜ëŒ€ì˜ ì¼€ì´ìŠ¤ëŠ” ì…ì–‘ì´ ë˜ì§€ ì•Šì€ ìƒì¡´ì´ë©°, ì´ ìƒì¡´ì˜ ëˆ„ì ê³±ì´ ìƒì¡´í•¨ìˆ˜ê°€ ëœë‹¤. df[&#39;surv&#39;] = (1 - df[&#39;hazard&#39;]).cumprod() df adopted at_risk hazard surv 1 1 7 0.142857 0.857143 2 1 6 0.166667 0.714286 4 1 4 0.250000 0.535714 5 1 3 0.333333 0.357143 7 0 1 0.000000 0.357143 ëˆ„ì  ë¶„í¬í•¨ìˆ˜ëŠ” 1 - ìƒì¡´í•¨ìˆ˜ì´ë‹¤. df[&#39;cdf&#39;] = 1 - df[&#39;surv&#39;] df adopted at_risk hazard surv cdf 1 1 7 0.142857 0.857143 0.142857 2 1 6 0.166667 0.714286 0.285714 4 1 4 0.250000 0.535714 0.464286 5 1 3 0.333333 0.357143 0.642857 7 0 1 0.000000 0.357143 0.642857 í™•ë¥  ì§ˆëŸ‰í•¨ìˆ˜ëŠ” cdfì˜ ë³€í™”ëŸ‰ì´ë‹¤ df[&#39;pdf&#39;] = np.diff(df[&#39;cdf&#39;],prepend=0) df adopted at_risk hazard surv cdf pdf 1 1 7 0.142857 0.857143 0.142857 0.142857 2 1 6 0.166667 0.714286 0.285714 0.142857 4 1 4 0.250000 0.535714 0.464286 0.178571 5 1 3 0.333333 0.357143 0.642857 0.178571 7 0 1 0.000000 0.357143 0.642857 0.000000 ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ ì¹´í”Œë€ë§ˆì´ì–´ ì¶”ì • ìœ„ì˜ í•˜ë“œì½”ë”©ìœ¼ë¡œ êµ¬í˜„í•œ ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ lifelines ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ë©´ ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. from lifelines import KaplanMeierFitter kmf = KaplanMeierFitter() T = shifted[&#39;end&#39;] E = shifted[&#39;status&#39;] kmf.fit(T,E) &lt;lifelines.KaplanMeierFitter:&quot;KM_estimate&quot;, fitted with 7 total observations, 3 right-censored observations&gt; kmf.survival_function_ KM_estimate timeline 0.0 1.000000 1.0 0.857143 2.0 0.714286 4.0 0.535714 5.0 0.357143 7.0 0.357143 ìƒì¡´í•¨ìˆ˜ì˜ confidence intervalì„ êµ¬í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ì˜ˆì œì˜ ìë£Œê°€ ë§¤ìš° ì‘ê¸°ì— CIëŠ” ìƒë‹¹íˆ ë„“ë‹¤. ci = kmf.confidence_interval_survival_function_ ci KM_estimate_lower_0.95 KM_estimate_upper_0.95 0.0 1.000000 1.000000 1.0 0.334054 0.978561 2.0 0.258154 0.919797 4.0 0.131988 0.824997 5.0 0.051977 0.698713 7.0 0.051977 0.698713 ts = ci.index low, high = np.transpose(ci.values) plt.fill_between(ts,low,high,color=&#39;grey&#39;,alpha=0.3) kmf.survival_function_.plot(ax=plt.gca()) plt.ylabel(&#39;Survival function&#39;) kmf.median_survival_time_ 5.0 ì¹´í”Œë€ ë§ˆì´ì–´ ê³¡ì„  í•´ì„ ìƒì¡´ ê³¡ì„ ì„ í†µí•´ ë‹¤ì–‘í•œ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë‹¤. í•´ë‹¹ ê°•ì•„ì§€ ë³´í˜¸ì†Œì˜ ì¤‘ìœ„ ìƒì¡´ê°’ì€ 5. ë”°ë¼ì„œ ì…ì†Œ í›„ 5ì£¼ì§¸ 50%ì˜ ì…ì–‘ì´ ë°œìƒí•œë‹¤. ê³µê°„ í™œìš© ìµœì í™”ë¥¼ ìœ„í•´ ì–´ëŠ ì£¼ê¸°ë¡œ ì‹ ê·œ ì…ì†Œê²¬ì„ ë°›ì•„ì•¼ í• ì§€ ê²°ì •í•  ìˆ˜ ìˆë‹¤. ë˜í•œ, ì…ì–‘ ì‚¬ê±´ ë°œìƒì‹œ ë§¤ì¶œì´ ë°œìƒí•œë‹¤ë©´, ìƒì¡´ê¸°ê°„ê³¼ ë§¤ì¶œì„ ê³±í•˜ì—¬ LTVì™€ ì˜ˆìƒ ë§¤ì¶œì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤." />
<link rel="canonical" href="http://localhost:4000/articles/2023/03/29/%EC%83%9D%EC%A1%B4%EB%B6%84%EC%84%9D-%EC%B9%B4%ED%94%8C%EB%9E%80-%EB%A7%88%EC%9D%B4%EC%96%B4-%EC%98%88%EC%A0%9C" />
<meta property="og:url" content="http://localhost:4000/articles/2023/03/29/%EC%83%9D%EC%A1%B4%EB%B6%84%EC%84%9D-%EC%B9%B4%ED%94%8C%EB%9E%80-%EB%A7%88%EC%9D%B4%EC%96%B4-%EC%98%88%EC%A0%9C" />
<meta property="og:site_name" content="Data Archive Doyle" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-29T15:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ìƒì¡´ ë¶„ì„ - ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • [íŒŒì´ì¬ ì˜ˆì œ]" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Doyle"},"dateModified":"2023-03-29T15:00:00+09:00","datePublished":"2023-03-29T15:00:00+09:00","description":"ì¹´í”Œë€ ë§ˆì´ì–´ í•˜ë“œì½”ë”© ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ê°•ì•„ì§€ ë³´í˜¸ì†Œë¥¼ ì˜ˆì‹œë¡œ ì‚¬ìš©í•œë‹¤. ê°•ì•„ì§€ ë³´í˜¸ì†Œì—ëŠ” ìƒˆë¡œìš´ ê°•ì•„ì§€ê°€ ì…ì†Œí•˜ê³ , ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì´ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ ê°•ì•„ì§€ê°€ ë³´í˜¸ì†Œì— ë‚¨ì•„ìˆëŠ” ê¸°ê°„ì„ ìƒì¡´ê¸°ê°„ìœ¼ë¡œ, ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì„ ìœ„í—˜ìœ¼ë¡œ ê°„ì£¼í•œë‹¤. ë°ì´í„° ì…‹ êµ¬ì„± ê°€ìƒì˜ ê°•ì•„ì§€ ë³´í˜¸ì†Œ ë°ì´í„° êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ë‹¤. start : ë³´í˜¸ì†Œ ì…ì†Œ ì‹œê°„ end : ì…ì–‘ ì‚¬ê±´ ë°œìƒ ì‹œê°„. 9ëŠ” ê´€ì¸¡ ì¢…ë£Œ ì‹œì ì´ë¯€ë¡œ í•´ë‹¹ ì»¬ëŸ¼ì´ 9ì¼ ê²½ìš° cencored status : 1ì¼ ê²½ìš° ì‚¬ê±´ ë°œìƒ, 0ì¼ ê²½ìš° ì‚¬ê±´ ë¯¸ë°œìƒ import pandas as pd import numpy as np import matplotlib.pyplot as plt obs = pd.DataFrame() obs[&#39;start&#39;] = 0,1,2,2,4,6,7 obs[&#39;end&#39;] = 5,2,6,9,9,8,9 obs[&#39;status&#39;] = 1,1,1,0,0,1,0 obs start end status 0 0 5 1 1 1 2 1 2 2 6 1 3 2 9 0 4 4 9 0 5 6 8 1 6 7 9 0 A. ë ˆì½”ë“œ plot def plot_lifelines(obs): for y,row in obs.iterrows(): start = row[&#39;start&#39;] end = row[&#39;end&#39;] status = row[&#39;status&#39;] if status == 0: plt.hlines(y,start,end,color=&#39;C0&#39;) else : plt.hlines(y,start,end,color=&#39;C1&#39;) plt.plot(end,y,marker=&#39;o&#39;,color=&#39;C1&#39;) plt.xlabel(&#39;Time (weeks)&#39;) plt.ylabel(&#39;Dog Index&#39;) plt.gca().invert_yaxis() plot_lifelines(obs) ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ ë‘ê°€ì§€ ì•„ì´ë””ì–´ì—ì„œ ì‹œì‘í•œë‹¤. ë ˆì½”ë“œì˜ ì‹œì‘ì§€ì ì„ ë¬´ì‹œí•˜ê³  duration timeë§Œì„ ê³ ë ¤í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ë¥¼ ì¶”ì •í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ëŠ” ê° ê¸°ê°„ ë‚´ ë°œìƒí•œ ì‚¬ê±´ì„ ìœ„í—˜ì— ì²˜í•œ ì´ ë ˆì½”ë“œ ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ ë„ì¶œí•œë‹¤. A. Duration time ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì„¸íŠ¸ ìƒì„± duration = obs[&#39;end&#39;] - obs[&#39;start&#39;] shifted = obs.copy() shifted[&#39;start&#39;] = 0 shifted[&#39;end&#39;] = duration plot_lifelines(shifted) plt.xlabel(&#39;Duration (week)&#39;); B. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ At Risk ë„ì¶œ At RiskëŠ” íŠ¹ì • ê¸°ê°„ë™ì•ˆ ì‚¬ê±´ì´ ë°œìƒí•˜ì§€ ì•Šì•˜ê±°ë‚˜ ì ˆë‹¨ë˜ì§€ ì•Šì€ ë ˆì½”ë“œì˜ ìˆ˜ë¥¼ ëœ»í•œë‹¤. ì•„ë˜ ì½”ë“œëŠ” numpyì˜ meshgrid í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ê±´ì´ ë°œìƒí•œ Duration Timeê³¼ ê° ë ˆì½”ë“œì˜ end ì‹œì ì„ ê°ê° ë¹„êµí•œë‹¤. ì‚¬ê±´ì´ ë°œìƒí•œ $Duration Time_i$ ë³´ë‹¤ ë ˆì½”ë“œì˜ $end_i$ ì‹œì ì´ ê°™ê±°ë‚˜ í¬ë‹¤ë©´, $DurationTime_i$ ë‚´ì— ìƒì¡´í•œ ë ˆì½”ë“œì´ë‹¤. ì¦‰, ì‚¬ê±´ì´ ë°œìƒí•œ ê°ê°ì˜ Duration Time ë‚´ ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œë“¤ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤. ts = duration.unique() ts.sort() ts â‡’ array([1, 2, 4, 5, 7]) E,T = np.meshgrid(shifted[&#39;end&#39;],ts) E array([[5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2], [5, 1, 4, 7, 5, 2, 2]]) at_risk = (T &lt;= E).sum(axis=1) at_risk array([7, 6, 4, 3, 1]) T&lt;br [&lt;br&gt; [1, 1, 1, 1, 1, 1, 1],&lt;br&gt; [2, 2, 2, 2, 2, 2, 2],&lt;br&gt; [4, 4, 4, 4, 4, 4, 4],&lt;br&gt; [5, 5, 5, 5, 5, 5, 5],&lt;br&gt; [7, 7, 7, 7, 7, 7, 7]&lt;br&gt; ]&lt;br&gt; &lt;= E&lt;br&gt; [&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2],&lt;br&gt; [5, 1, 4, 7, 5, 2, 2]&lt;br&gt; ]&lt;br&gt; This results in a boolean array: [&lt;br&gt; [True, True, True, True, True, True, True],&lt;br&gt; [True, False, True, True, True, True, True],&lt;br&gt; [True, False, True, True, True, False, False],&lt;br&gt; [True, False, False, True, True, False, False],&lt;br&gt; [False, False, False, True, False, False, False]&lt;br&gt; ]&lt;br&gt; [7, 6, 4, 3, 1] This gives us the number of individuals who are considered &quot;at risk&quot; for each time point. C. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ ì‚¬ê±´ ë°œìƒ ìˆ˜ ë„ì¶œ ê° t(Duration Time)ë§ˆë‹¤ ì…ì–‘ì´ ë°œìƒí•œ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤. adopted = pd.Series(0,index=ts) for t in ts: k = (shifted[&#39;status&#39;]==1) &amp; (t == shifted[&#39;end&#39;]) adopted[t] = k.sum() adopted 1 1 2 1 4 1 5 1 7 0 dtype: int64 d = dict(adopted=adopted, at_risk=at_risk) df= pd.DataFrame(d,index=ts) df adopted at_risk 1 1 7 2 1 6 4 1 4 5 1 3 7 0 1 D. ìœ„í—˜í•¨ìˆ˜ ê³„ì‚°. ì‚¬ê±´ë°œìƒ ìˆ˜ / ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œ ìˆ˜ df[&#39;hazard&#39;] = df[&#39;adopted&#39;]/df[&#39;at_risk&#39;] df adopted at_risk hazard 1 1 7 0.142857 2 1 6 0.166667 4 1 4 0.250000 5 1 3 0.333333 7 0 1 0.000000 ìƒì¡´í•¨ìˆ˜ ê³„ì‚° ìœ„ì—ì„œ ê³„ì‚°í•œ ìœ„í—˜í•¨ìˆ˜ëŠ” íŠ¹ì • ê¸°ê°„ì— ì‚¬ê±´ì´ ë°œìƒí•  í™•ë¥ ì´ë‹¤. ì´ ì¼€ì´ìŠ¤ì—ì„œ ì‚¬ê±´ì€ ì…ì–‘ì´ë‹¤. ë”°ë¼ì„œ ë°˜ëŒ€ì˜ ì¼€ì´ìŠ¤ëŠ” ì…ì–‘ì´ ë˜ì§€ ì•Šì€ ìƒì¡´ì´ë©°, ì´ ìƒì¡´ì˜ ëˆ„ì ê³±ì´ ìƒì¡´í•¨ìˆ˜ê°€ ëœë‹¤. df[&#39;surv&#39;] = (1 - df[&#39;hazard&#39;]).cumprod() df adopted at_risk hazard surv 1 1 7 0.142857 0.857143 2 1 6 0.166667 0.714286 4 1 4 0.250000 0.535714 5 1 3 0.333333 0.357143 7 0 1 0.000000 0.357143 ëˆ„ì  ë¶„í¬í•¨ìˆ˜ëŠ” 1 - ìƒì¡´í•¨ìˆ˜ì´ë‹¤. df[&#39;cdf&#39;] = 1 - df[&#39;surv&#39;] df adopted at_risk hazard surv cdf 1 1 7 0.142857 0.857143 0.142857 2 1 6 0.166667 0.714286 0.285714 4 1 4 0.250000 0.535714 0.464286 5 1 3 0.333333 0.357143 0.642857 7 0 1 0.000000 0.357143 0.642857 í™•ë¥  ì§ˆëŸ‰í•¨ìˆ˜ëŠ” cdfì˜ ë³€í™”ëŸ‰ì´ë‹¤ df[&#39;pdf&#39;] = np.diff(df[&#39;cdf&#39;],prepend=0) df adopted at_risk hazard surv cdf pdf 1 1 7 0.142857 0.857143 0.142857 0.142857 2 1 6 0.166667 0.714286 0.285714 0.142857 4 1 4 0.250000 0.535714 0.464286 0.178571 5 1 3 0.333333 0.357143 0.642857 0.178571 7 0 1 0.000000 0.357143 0.642857 0.000000 ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ ì¹´í”Œë€ë§ˆì´ì–´ ì¶”ì • ìœ„ì˜ í•˜ë“œì½”ë”©ìœ¼ë¡œ êµ¬í˜„í•œ ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ lifelines ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ë©´ ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. from lifelines import KaplanMeierFitter kmf = KaplanMeierFitter() T = shifted[&#39;end&#39;] E = shifted[&#39;status&#39;] kmf.fit(T,E) &lt;lifelines.KaplanMeierFitter:&quot;KM_estimate&quot;, fitted with 7 total observations, 3 right-censored observations&gt; kmf.survival_function_ KM_estimate timeline 0.0 1.000000 1.0 0.857143 2.0 0.714286 4.0 0.535714 5.0 0.357143 7.0 0.357143 ìƒì¡´í•¨ìˆ˜ì˜ confidence intervalì„ êµ¬í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ì˜ˆì œì˜ ìë£Œê°€ ë§¤ìš° ì‘ê¸°ì— CIëŠ” ìƒë‹¹íˆ ë„“ë‹¤. ci = kmf.confidence_interval_survival_function_ ci KM_estimate_lower_0.95 KM_estimate_upper_0.95 0.0 1.000000 1.000000 1.0 0.334054 0.978561 2.0 0.258154 0.919797 4.0 0.131988 0.824997 5.0 0.051977 0.698713 7.0 0.051977 0.698713 ts = ci.index low, high = np.transpose(ci.values) plt.fill_between(ts,low,high,color=&#39;grey&#39;,alpha=0.3) kmf.survival_function_.plot(ax=plt.gca()) plt.ylabel(&#39;Survival function&#39;) kmf.median_survival_time_ 5.0 ì¹´í”Œë€ ë§ˆì´ì–´ ê³¡ì„  í•´ì„ ìƒì¡´ ê³¡ì„ ì„ í†µí•´ ë‹¤ì–‘í•œ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë‹¤. í•´ë‹¹ ê°•ì•„ì§€ ë³´í˜¸ì†Œì˜ ì¤‘ìœ„ ìƒì¡´ê°’ì€ 5. ë”°ë¼ì„œ ì…ì†Œ í›„ 5ì£¼ì§¸ 50%ì˜ ì…ì–‘ì´ ë°œìƒí•œë‹¤. ê³µê°„ í™œìš© ìµœì í™”ë¥¼ ìœ„í•´ ì–´ëŠ ì£¼ê¸°ë¡œ ì‹ ê·œ ì…ì†Œê²¬ì„ ë°›ì•„ì•¼ í• ì§€ ê²°ì •í•  ìˆ˜ ìˆë‹¤. ë˜í•œ, ì…ì–‘ ì‚¬ê±´ ë°œìƒì‹œ ë§¤ì¶œì´ ë°œìƒí•œë‹¤ë©´, ìƒì¡´ê¸°ê°„ê³¼ ë§¤ì¶œì„ ê³±í•˜ì—¬ LTVì™€ ì˜ˆìƒ ë§¤ì¶œì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.","headline":"ìƒì¡´ ë¶„ì„ - ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • [íŒŒì´ì¬ ì˜ˆì œ]","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/articles/2023/03/29/%EC%83%9D%EC%A1%B4%EB%B6%84%EC%84%9D-%EC%B9%B4%ED%94%8C%EB%9E%80-%EB%A7%88%EC%9D%B4%EC%96%B4-%EC%98%88%EC%A0%9C"},"url":"http://localhost:4000/articles/2023/03/29/%EC%83%9D%EC%A1%B4%EB%B6%84%EC%84%9D-%EC%B9%B4%ED%94%8C%EB%9E%80-%EB%A7%88%EC%9D%B4%EC%96%B4-%EC%98%88%EC%A0%9C"}</script>
<!-- End Jekyll SEO tag -->

  
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
              // ...options...
          });
      });
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/articles/2023/03/29/%EC%83%9D%EC%A1%B4%EB%B6%84%EC%84%9D-%EC%B9%B4%ED%94%8C%EB%9E%80-%EB%A7%88%EC%9D%B4%EC%96%B4-%EC%98%88%EC%A0%9C">
  <link rel="alternate" type="application/rss+xml" title="Data Archive | Doyle" href="http://localhost:4000/feed.xml">
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">

  <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-UA-185737211-1"></script> -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-185737211-1');
  </script>
</head>

  
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
  
  <body>
    <header class="site-header">

  <div class="wrapper">
    <a class="site-title" style="text-decoration: none" href="/">
<!--       &lt;:]{%&gt; == []{} -->
<!--      &lt;<span style="color: #ff5400;">daegikim</span>.github.io/&gt;-->
        Doyle, DA
        <span style="display: inline-block" class=" animated bounceIn">ğŸš€</span>
    </a>
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
           
          <a class="page-link" href="/about">About</a>
          
          <a class="page-link" href="/">Blog</a>
                                               
      </div>
    </nav>
  </div>
</header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/math...">
    </script>

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">ìƒì¡´ ë¶„ì„ - ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì • [íŒŒì´ì¬ ì˜ˆì œ]</h1>
    <p class="post-meta">
      <span class="left">
        <time datetime="2023-03-29T15:00:00+09:00" itemprop="datePublished">Mar 29, 2023</time>
       <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Doyle</span></span>
      </span>
      <span class="right">
        <span class="post-author-image" style="background-image:url(/assets/images/conan.png);"></span>
      </span>
    </p>
  </header>
  <div class="post-content" itemprop="articleBody">
    <h2 id="ì¹´í”Œë€-ë§ˆì´ì–´-í•˜ë“œì½”ë”©">ì¹´í”Œë€ ë§ˆì´ì–´ í•˜ë“œì½”ë”©</h2>

<p>ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ê°•ì•„ì§€ ë³´í˜¸ì†Œë¥¼ ì˜ˆì‹œë¡œ ì‚¬ìš©í•œë‹¤. ê°•ì•„ì§€ ë³´í˜¸ì†Œì—ëŠ” ìƒˆë¡œìš´ ê°•ì•„ì§€ê°€ ì…ì†Œí•˜ê³ , ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì´ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ ê°•ì•„ì§€ê°€ ë³´í˜¸ì†Œì— ë‚¨ì•„ìˆëŠ” ê¸°ê°„ì„ ìƒì¡´ê¸°ê°„ìœ¼ë¡œ, ì…ì–‘ë˜ì–´ í‡´ì†Œí•˜ëŠ” ì‚¬ê±´ì„ ìœ„í—˜ìœ¼ë¡œ ê°„ì£¼í•œë‹¤.</p>

<h3 id="ë°ì´í„°-ì…‹-êµ¬ì„±">ë°ì´í„° ì…‹ êµ¬ì„±</h3>
<p>ê°€ìƒì˜ ê°•ì•„ì§€ ë³´í˜¸ì†Œ ë°ì´í„° êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ë‹¤.<br /></p>
<ul>
  <li>start : ë³´í˜¸ì†Œ ì…ì†Œ ì‹œê°„</li>
  <li>end : ì…ì–‘ ì‚¬ê±´ ë°œìƒ ì‹œê°„. 9ëŠ” ê´€ì¸¡ ì¢…ë£Œ ì‹œì ì´ë¯€ë¡œ í•´ë‹¹ ì»¬ëŸ¼ì´ 9ì¼ ê²½ìš° cencored</li>
  <li>status : 1ì¼ ê²½ìš° ì‚¬ê±´ ë°œìƒ, 0ì¼ ê²½ìš° ì‚¬ê±´ ë¯¸ë°œìƒ</li>
</ul>

<pre><code class="language-python">import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

obs = pd.DataFrame()

obs['start'] = 0,1,2,2,4,6,7
obs['end'] = 5,2,6,9,9,8,9
obs['status'] = 1,1,1,0,0,1,0
obs
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start</th>
      <th>end</th>
      <th>status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>9</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>9</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>8</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>9</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="a-ë ˆì½”ë“œ-plot">A. ë ˆì½”ë“œ plot</h4>
<pre><code class="language-python">def plot_lifelines(obs):
    for y,row in obs.iterrows():
        start = row['start']
        end = row['end']
        status = row['status']

        if status == 0:
            plt.hlines(y,start,end,color='C0')
        else :
            plt.hlines(y,start,end,color='C1')
            plt.plot(end,y,marker='o',color='C1')
    plt.xlabel('Time (weeks)')
    plt.ylabel('Dog Index')
    plt.gca().invert_yaxis()

plot_lifelines(obs)
</code></pre>
<p><img src="https://i.imgur.com/s29QseL.png" alt="" /></p>

<h3 id="ì¹´í”Œë€-ë§ˆì´ì–´-ì¶”ì •">ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •</h3>
<p>ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ ë‘ê°€ì§€ ì•„ì´ë””ì–´ì—ì„œ ì‹œì‘í•œë‹¤.</p>
<ol>
  <li>ë ˆì½”ë“œì˜ ì‹œì‘ì§€ì ì„ ë¬´ì‹œí•˜ê³  duration timeë§Œì„ ê³ ë ¤í•œë‹¤.</li>
  <li>ìœ„í—˜í•¨ìˆ˜ë¥¼ ì¶”ì •í•œë‹¤. ìœ„í—˜í•¨ìˆ˜ëŠ” ê° ê¸°ê°„ ë‚´ ë°œìƒí•œ ì‚¬ê±´ì„ ìœ„í—˜ì— ì²˜í•œ ì´ ë ˆì½”ë“œ ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ ë„ì¶œí•œë‹¤.</li>
</ol>

<h4 id="a-duration-time-ì„-ê¸°ì¤€ìœ¼ë¡œ-ë°ì´í„°ì„¸íŠ¸-ìƒì„±">A. Duration time ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì„¸íŠ¸ ìƒì„±</h4>
<pre><code class="language-python">duration = obs['end'] - obs['start']
shifted = obs.copy()
shifted['start'] = 0
shifted['end'] = duration

plot_lifelines(shifted)
plt.xlabel('Duration (week)');
</code></pre>

<p><img src="https://i.imgur.com/AoD4nlb.png" alt="" /></p>

<h4 id="b-ìœ„í—˜í•¨ìˆ˜-ë„ì¶œì„-ìœ„í•œ-at-risk-ë„ì¶œ">B. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ At Risk ë„ì¶œ</h4>
<p>At RiskëŠ” íŠ¹ì • ê¸°ê°„ë™ì•ˆ ì‚¬ê±´ì´ ë°œìƒí•˜ì§€ ì•Šì•˜ê±°ë‚˜ ì ˆë‹¨ë˜ì§€ ì•Šì€ ë ˆì½”ë“œì˜ ìˆ˜ë¥¼ ëœ»í•œë‹¤.
ì•„ë˜ ì½”ë“œëŠ” numpyì˜ meshgrid í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ê±´ì´ ë°œìƒí•œ Duration Timeê³¼ ê° ë ˆì½”ë“œì˜ end ì‹œì ì„ ê°ê° ë¹„êµí•œë‹¤. 
ì‚¬ê±´ì´ ë°œìƒí•œ $Duration Time_i$ ë³´ë‹¤ ë ˆì½”ë“œì˜ $end_i$ ì‹œì ì´ ê°™ê±°ë‚˜ í¬ë‹¤ë©´, $DurationTime_i$ ë‚´ì— ìƒì¡´í•œ ë ˆì½”ë“œì´ë‹¤. ì¦‰, ì‚¬ê±´ì´ ë°œìƒí•œ ê°ê°ì˜ Duration Time ë‚´ ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œë“¤ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤.</p>
<pre><code class="language-python">ts = duration.unique()
ts.sort()
ts
</code></pre>

<pre><code>â‡’ array([1, 2, 4, 5, 7])
</code></pre>

<pre><code class="language-python">E,T = np.meshgrid(shifted['end'],ts)
E
</code></pre>
<pre><code>array([[5, 1, 4, 7, 5, 2, 2],
       [5, 1, 4, 7, 5, 2, 2],
       [5, 1, 4, 7, 5, 2, 2],
       [5, 1, 4, 7, 5, 2, 2],
       [5, 1, 4, 7, 5, 2, 2]])
</code></pre>

<pre><code class="language-python">at_risk = (T &lt;= E).sum(axis=1)
at_risk
</code></pre>
<pre><code>array([7, 6, 4, 3, 1])
</code></pre>

<pre><code>T&lt;br
[&lt;br&gt;
    [1, 1, 1, 1, 1, 1, 1],&lt;br&gt;
    [2, 2, 2, 2, 2, 2, 2],&lt;br&gt;
    [4, 4, 4, 4, 4, 4, 4],&lt;br&gt;
    [5, 5, 5, 5, 5, 5, 5],&lt;br&gt;
    [7, 7, 7, 7, 7, 7, 7]&lt;br&gt;
]&lt;br&gt;
&lt;=
E&lt;br&gt;
[&lt;br&gt;
    [5, 1, 4, 7, 5, 2, 2],&lt;br&gt;
    [5, 1, 4, 7, 5, 2, 2],&lt;br&gt;
    [5, 1, 4, 7, 5, 2, 2],&lt;br&gt;
    [5, 1, 4, 7, 5, 2, 2],&lt;br&gt;
    [5, 1, 4, 7, 5, 2, 2]&lt;br&gt;
]&lt;br&gt;

This results in a boolean array:

[&lt;br&gt;
    [True,  True,  True,  True,  True,  True,  True],&lt;br&gt;
    [True, False,  True, True,  True, True, True],&lt;br&gt;
    [True, False,  True, True,  True, False, False],&lt;br&gt;
    [True, False,  False, True,  True, False, False],&lt;br&gt;
    [False, False, False, True, False, False, False]&lt;br&gt;
]&lt;br&gt;

[7, 6, 4, 3, 1]

This gives us the number of individuals who are considered "at risk" for each time point.
</code></pre>

<h4 id="c-ìœ„í—˜í•¨ìˆ˜-ë„ì¶œì„-ìœ„í•œ-ì‚¬ê±´-ë°œìƒ-ìˆ˜-ë„ì¶œ">C. ìœ„í—˜í•¨ìˆ˜ ë„ì¶œì„ ìœ„í•œ ì‚¬ê±´ ë°œìƒ ìˆ˜ ë„ì¶œ</h4>
<p>ê° t(Duration Time)ë§ˆë‹¤ ì…ì–‘ì´ ë°œìƒí•œ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤.</p>

<pre><code class="language-python">adopted = pd.Series(0,index=ts)

for t in ts:
    k = (shifted['status']==1) &amp; (t == shifted['end'])
    adopted[t] = k.sum()

adopted
</code></pre>
<pre><code>1    1
2    1
4    1
5    1
7    0
dtype: int64
</code></pre>

<pre><code class="language-python">d = dict(adopted=adopted,
        at_risk=at_risk)
df= pd.DataFrame(d,index=ts)
df
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>adopted</th>
      <th>at_risk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="d-ìœ„í—˜í•¨ìˆ˜-ê³„ì‚°-ì‚¬ê±´ë°œìƒ-ìˆ˜--ìœ„í—˜ì—-ë…¸ì¶œëœ-ë ˆì½”ë“œ-ìˆ˜">D. ìœ„í—˜í•¨ìˆ˜ ê³„ì‚°. ì‚¬ê±´ë°œìƒ ìˆ˜ / ìœ„í—˜ì— ë…¸ì¶œëœ ë ˆì½”ë“œ ìˆ˜</h4>
<pre><code class="language-python">df['hazard'] = df['adopted']/df['at_risk']
df
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>adopted</th>
      <th>at_risk</th>
      <th>hazard</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7</td>
      <td>0.142857</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>0.166667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
      <td>0.250000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>3</td>
      <td>0.333333</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="ìƒì¡´í•¨ìˆ˜-ê³„ì‚°">ìƒì¡´í•¨ìˆ˜ ê³„ì‚°</h3>
<p>ìœ„ì—ì„œ ê³„ì‚°í•œ ìœ„í—˜í•¨ìˆ˜ëŠ” íŠ¹ì • ê¸°ê°„ì— ì‚¬ê±´ì´ ë°œìƒí•  í™•ë¥ ì´ë‹¤. ì´ ì¼€ì´ìŠ¤ì—ì„œ ì‚¬ê±´ì€ ì…ì–‘ì´ë‹¤.
ë”°ë¼ì„œ ë°˜ëŒ€ì˜ ì¼€ì´ìŠ¤ëŠ” ì…ì–‘ì´ ë˜ì§€ ì•Šì€ ìƒì¡´ì´ë©°, ì´ ìƒì¡´ì˜ ëˆ„ì ê³±ì´ ìƒì¡´í•¨ìˆ˜ê°€ ëœë‹¤.</p>

<pre><code class="language-python">df['surv'] = (1 - df['hazard']).cumprod()
df
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>adopted</th>
      <th>at_risk</th>
      <th>hazard</th>
      <th>surv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7</td>
      <td>0.142857</td>
      <td>0.857143</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>0.166667</td>
      <td>0.714286</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
      <td>0.250000</td>
      <td>0.535714</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>3</td>
      <td>0.333333</td>
      <td>0.357143</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.357143</td>
    </tr>
  </tbody>
</table>
</div>

<p>ëˆ„ì  ë¶„í¬í•¨ìˆ˜ëŠ” 1 - ìƒì¡´í•¨ìˆ˜ì´ë‹¤.</p>
<pre><code class="language-python">df['cdf'] = 1 - df['surv']
df
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>adopted</th>
      <th>at_risk</th>
      <th>hazard</th>
      <th>surv</th>
      <th>cdf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7</td>
      <td>0.142857</td>
      <td>0.857143</td>
      <td>0.142857</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>0.166667</td>
      <td>0.714286</td>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
      <td>0.250000</td>
      <td>0.535714</td>
      <td>0.464286</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>3</td>
      <td>0.333333</td>
      <td>0.357143</td>
      <td>0.642857</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.357143</td>
      <td>0.642857</td>
    </tr>
  </tbody>
</table>
</div>

<p>í™•ë¥  ì§ˆëŸ‰í•¨ìˆ˜ëŠ” cdfì˜ ë³€í™”ëŸ‰ì´ë‹¤</p>

<pre><code class="language-python">df['pdf'] = np.diff(df['cdf'],prepend=0)
df
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>adopted</th>
      <th>at_risk</th>
      <th>hazard</th>
      <th>surv</th>
      <th>cdf</th>
      <th>pdf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7</td>
      <td>0.142857</td>
      <td>0.857143</td>
      <td>0.142857</td>
      <td>0.142857</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>0.166667</td>
      <td>0.714286</td>
      <td>0.285714</td>
      <td>0.142857</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
      <td>0.250000</td>
      <td>0.535714</td>
      <td>0.464286</td>
      <td>0.178571</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>3</td>
      <td>0.333333</td>
      <td>0.357143</td>
      <td>0.642857</td>
      <td>0.178571</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.357143</td>
      <td>0.642857</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼-ì´ìš©í•œ-ì¹´í”Œë€ë§ˆì´ì–´-ì¶”ì •">ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ ì¹´í”Œë€ë§ˆì´ì–´ ì¶”ì •</h2>
<p>ìœ„ì˜ í•˜ë“œì½”ë”©ìœ¼ë¡œ êµ¬í˜„í•œ ì¹´í”Œë€ ë§ˆì´ì–´ ì¶”ì •ì€ lifelines ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ë©´ ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.</p>

<pre><code class="language-python">from lifelines import KaplanMeierFitter
kmf = KaplanMeierFitter()

T = shifted['end']
E = shifted['status']

kmf.fit(T,E)
</code></pre>
<pre><code>&lt;lifelines.KaplanMeierFitter:"KM_estimate", fitted with 7 total observations, 3 right-censored observations&gt;
</code></pre>

<pre><code class="language-python">kmf.survival_function_
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>KM_estimate</th>
    </tr>
    <tr>
      <th>timeline</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>0.857143</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.714286</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.535714</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.357143</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>0.357143</td>
    </tr>
  </tbody>
</table>
</div>

<p>ìƒì¡´í•¨ìˆ˜ì˜ confidence intervalì„ êµ¬í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ì˜ˆì œì˜ ìë£Œê°€ ë§¤ìš° ì‘ê¸°ì— CIëŠ” ìƒë‹¹íˆ ë„“ë‹¤.</p>
<pre><code class="language-python">ci = kmf.confidence_interval_survival_function_
ci
</code></pre>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>KM_estimate_lower_0.95</th>
      <th>KM_estimate_upper_0.95</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>0.334054</td>
      <td>0.978561</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.258154</td>
      <td>0.919797</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.131988</td>
      <td>0.824997</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.051977</td>
      <td>0.698713</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>0.051977</td>
      <td>0.698713</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">ts = ci.index
low, high = np.transpose(ci.values)
plt.fill_between(ts,low,high,color='grey',alpha=0.3)
kmf.survival_function_.plot(ax=plt.gca())
plt.ylabel('Survival function')
</code></pre>

<p><img src="https://i.imgur.com/Twq7kCX.png" alt="" /></p>

<pre><code class="language-python">kmf.median_survival_time_
</code></pre>
<p>5.0</p>

<h3 id="ì¹´í”Œë€-ë§ˆì´ì–´-ê³¡ì„ -í•´ì„">ì¹´í”Œë€ ë§ˆì´ì–´ ê³¡ì„  í•´ì„</h3>
<p>ìƒì¡´ ê³¡ì„ ì„ í†µí•´ ë‹¤ì–‘í•œ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë‹¤.</p>
<ol>
  <li>í•´ë‹¹ ê°•ì•„ì§€ ë³´í˜¸ì†Œì˜ ì¤‘ìœ„ ìƒì¡´ê°’ì€ 5. ë”°ë¼ì„œ ì…ì†Œ í›„ 5ì£¼ì§¸ 50%ì˜ ì…ì–‘ì´ ë°œìƒí•œë‹¤.</li>
  <li>ê³µê°„ í™œìš© ìµœì í™”ë¥¼ ìœ„í•´ ì–´ëŠ ì£¼ê¸°ë¡œ ì‹ ê·œ ì…ì†Œê²¬ì„ ë°›ì•„ì•¼ í• ì§€ ê²°ì •í•  ìˆ˜ ìˆë‹¤.</li>
  <li>ë˜í•œ, ì…ì–‘ ì‚¬ê±´ ë°œìƒì‹œ ë§¤ì¶œì´ ë°œìƒí•œë‹¤ë©´, ìƒì¡´ê¸°ê°„ê³¼ ë§¤ì¶œì„ ê³±í•˜ì—¬ LTVì™€ ì˜ˆìƒ ë§¤ì¶œì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.</li>
</ol>


  </div>
</article>
<!-- 

<div id="disqus_thread"></div>
<script>
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://daegikim.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 -->

      </div>
    </div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="footer-heading">
      copyrignt
      <span style="display: inline-block; vertical-align: middle; transform: rotate(180deg)">&copy;</span>
      all rights reserved
    </div>
    <a href="https://github.com/skadudd"><i class="icon ion-logo-github"></i></a>
    <!-- <a href="https://www.linkedin.com/in/daegi-kim-6b23045b"><i class="icon ion-logo-linkedin"></i></a> -->
    <a href="https://www.instagram.com/naamyoung/"><i class="icon ion-logo-instagram"></i></a>
  </div>
</footer>

  </body>
</html>