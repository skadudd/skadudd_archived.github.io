<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="SQL">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ì‹œê³„ì—´ ë¶„ì„ - SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„ MySQL | Data Archive Doyle</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="ì‹œê³„ì—´ ë¶„ì„ - SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„ MySQL" />
<meta name="author" content="Doyle" />
<meta property="og:locale" content="ko_KR" />
<meta name="description" content="PostgreSQLë¡œ ì‘ì„±ëœ ì„œì ì¸ OREILLYì˜ â€˜SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„â€™ì„ MySQLë¡œ ë³€í™˜í•˜ë©° ìŠ¤í„°ë””í•œ ë‚´ìš©. ì‹œê³„ì—´ ë¶„ì„ íŒŒíŠ¸ì˜ ë°ì´í„° í…Œì´ë¸” ì •ë¦¬ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë  í…Œì´ë¸” í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤. A. Table Scheme sales_month naics_code kind_f_business reason_for_null sales 1992-01-01 441 Motor vehicle and parts dealers Â  29811.00 1992-01-01 4411 Automobile dealers Â  25800.00 1992-01-01 4411, 4412 Automobile and other motor vehicle dealers Â  26788.00 1992-01-01 44111 New car dealers Â  24056.00 retail_sales í…Œì´ë¸” íŒë§¤ ì¼ì, ì†Œë§¤ ì—…ì¢…, íŒë§¤ì•¡ì´ ì ì¬ ë˜ì–´ìˆë‹¤. date date_key day_of_month day_of_year day_of_week day_name day_short_name week_number week_of_month week month_number month_name month+short_name first_day_of_month last_day_of_month quarter_number quarter_name first_day_of_quarter last_day_of_quarter year decade centurays 1770-01-01 17700101 1 1 1 Monday Mon 1 1 1770-01-01 1 January Jan 1770-01-01 1770-01-31 1 Q1 1770-01-01 1770-03-31 1770 1770 18 1770-01-02 17700102 2 2 2 Tuesday Tue 1 1 1770-01-01 1 January Jan 1770-01-01 1770-01-31 1 Q1 1770-01-01 1770-03-31 1770 1770 18 date_dim í…Œì´ë¸” ë¶„ì„ì— í™œìš©í•˜ê³ ì í•˜ëŠ” í…Œì´ë¸”ì— íŠ¹ì • ì¼ìì˜ ë ˆì½”ë“œê°€ ì‚­ì œë˜ì–´ ìˆë‹¤ë©´ ì§‘ê³„ ì‹œ í˜¼ë€ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì‚¬ê³ ë¥¼ ë¯¸ì—°ì— ë°©ì§€í•˜ê³ ì ë‚ ì§œ ë£©ì—… í…Œì´ë¸”ì„ ì •ì˜í•˜ê³ , í•„ìš” ì‹œ joiní•˜ì—¬ ê²°ì¸¡ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì§‘ê³„ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•œë‹¤. B. ë‚ ì§œê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚°ì„ í—·ê°ˆë¦¬ì§€ ë§ì. ë‚ ì§œ ê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚° ë‘ íƒ€ì…ì„ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì. ë‚ ì§œ ê°„ ê³„ì‚°ì€ ë¬¸ì ê·¸ëŒ€ë¡œ ì‚°ìˆ ì ì¸ ë‚ ì§œê°„ì˜ ì°¨ì´ë¥¼, ì¸í„°ë²Œì€ ê´€ë…ì ì¸(í•˜ì´ ë ˆë²¨ì—ì„œì˜) ë‚ ì§œì˜ ê°œë…ì—ì„œì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•œë‹¤. select date_add(date(&#39;2020-01-01&#39;), interval 1 week) ì‹œê³„ì—´ ë¶„ì„ - ë¹„ìœ¨ê³¼ ì°¨ì´ A. ì°¨ì´ ê³„ì‚°í•˜ê¸° A.1. ë‚¨ì—¬ ë§¤ì¶œ ì°¨ì´ Subquery ver subqueryë¥¼ í™œìš©í•œ ê³„ì‚° SELECT year(sales_month) AS years, a.womens_sales, a.mens_sales, a.womens_sales - a.mens_sales AS diff_sales FROM retail_sales, ( SELECT year(sales_month) AS years, sum( CASE WHEN kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; THEN sales END) AS womens_sales, sum( CASE WHEN kind_of_business = &#39;Men&#39;&#39;s clothing stores&#39; THEN sales END) AS mens_sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;, &#39;Men&#39;&#39;s clothing stores&#39;) GROUP BY 1) a B. ì „ì²´ ëŒ€ë¹„ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ê¸° B.1. subquery &amp; self joinì„ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚° SELECT sales_month, kind_of_business, sales, sales / aa.total_sales * 100 AS pct_total_sales FROM ( SELECT a.sales_month, a.kind_of_business, a.sales, sum(b.sales) AS total_sales FROM retail_sales a JOIN retail_sales b ON a.sales_month = b.sales_month AND b.kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) WHERE a.kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1, 2, 3) aa ORDER BY 1, 2 B.2. Partition by, sum ìœˆë„ìš°í•¨ìˆ˜ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚° partition by ì ˆë¡œ í•¨ìˆ˜ê°€ ê³„ì‚°í•˜ëŠ” í…Œì´ë¸”ì˜ ì„¹ì…˜ì„ êµ¬ë¶„ SELECT sales_month, kind_of_business, sales, sum(sales) OVER (PARTITION BY sales_month) AS total_sales, round(sales * 100 / sum(sales) OVER (PARTITION BY sales_month), 2) AS pct FROM retail_sales WHERE kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) ORDER BY 1, 2 C. ì—…ì¢…ë³„, ì—°ë§¤ì¶œ ëŒ€ë¹„ ì›”ê°„ ë§¤ì¶œ C.1. ì„œë¸Œì¿¼ë¦¬ í™œìš© SELECT rs.sales_month, rs.kind_of_business, SUM(rs.sales) AS sales_m, aa.sales_y, round(SUM(rs.sales) / aa.sales_y, 2) AS ratio_m_y FROM retail_sales rs JOIN ( SELECT YEAR(sales_month) AS sales_year, SUM(sales) AS sales_y, kind_of_business FROM retail_sales WHERE kind_of_business IN(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY sales_year, kind_of_business) aa ON YEAR(rs.sales_month) = aa.sales_year AND rs.kind_of_business = aa.kind_of_business WHERE rs.kind_of_business IN(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY rs.sales_month, rs.kind_of_business, aa.sales_y ORDER BY 1 C.2. ìœˆë„ìš° í•¨ìˆ˜ í™œìš© SELECT sales_month, kind_of_business, sales, sum(sales) OVER (PARTITION BY year(sales_month), kind_of_business) AS yearly_sales, sales * 100 / sum(sales) OVER (PARTITION BY year(sales_month), kind_of_business) AS pct_yearly FROM retail_sales WHERE kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) ORDER BY 1, 2; D. ì¸ë±ì‹±ìœ¼ë¡œ ì‹œê³„ì—´ ë°ì´í„° ë³€í™” ì´í•´í•˜ê¸° ë°ì´í„° ì¸ë±ì‹±ì€ ì‹œê³„ì—´ì—ì„œ ë² ì´ìŠ¤ êµ¬ê°„(ì‹œì‘ ì§€ì )ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì˜ ë³€í™”ëŸ‰ì„ ì´í•´í•˜ëŠ” ë°©ë²•. ì§‘ê³„í•¨ìˆ˜ì™€ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì¡°í•©í•˜ê±°ë‚˜ self-joinì„ í™œìš©í•¨. ìœˆë„ìš° í•¨ìˆ˜ê°€ ë§¤ìš° ìœ ì—°í•œ ì‚¬ìš©ì„±ì„ ë³´ì´ê¸°ì—, ì´ì— ìµìˆ™í•´ì§€ëŠ”ê²Œ ì¢‹ë‹¤. SELECT sales_year, sales, first_value(sales) OVER (ORDER BY sales_year) AS index_sales FROM ( SELECT year(sales_month) AS sales_year, sum(sales) AS sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1) a D.1. ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš©í•œ ì¸ë±ì‹± SELECT sales_year, sales, (sales / FIRST_VALUE(sales) OVER (ORDER BY sales_year) - 1) * 100 AS index_sales FROM ( SELECT year(sales_month) AS sales_year, sum(sales) AS sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1) a ì‹œê³„ì—´ ë¶„ì„ - ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ì§‘ê³„ì™€ëŠ” ë˜ ë‹¤ë¥¸ ë…¸ì´ì¦ˆ ì œê±° ë°©ë²•. ì—¬ëŸ¬ êµ¬ê°„ì„ ì„¤ì •í•´ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•˜ëŠ” ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ (=ì´ë™ ê³„ì‚°) ì‹œê³„ì—´ ë¡¤ë§ ê³„ì‚°ì˜ ìš”ì†ŒëŠ” 3ê°€ì§€. 1) ìœˆë„ìš° ì‚¬ì´ì¦ˆ, 2) ì§‘ê³„ í•¨ìˆ˜, 3) ìœˆë„ìš° ë‚´ ë°ì´í„°ì˜ ë¶„í•  í˜¹ì€ ê·¸ë£¹í™” ì…€í”„ì¡°ì¸ê³¼ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš© A. ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ëˆ„ì  í•© SELECT a.sales_month, a.sales, b.sales_month AS rolling_sales_month, b.sales AS rolling_sales FROM retail_sales a JOIN retail_sales b ON a.kind_of_business = b.kind_of_business AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 MONTH) AND a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND a.sales_month = date(&#39;2019-12-01&#39;) B. ì´ë™í‰ê· ì„  B.1. self join SELECT a.sales_month, a.sales, avg(b.sales) AS ma_1y, count(b.sales) AS records FROM retail_sales a JOIN retail_sales b ON a.kind_of_business = b.kind_of_business AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 month) AND a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND a.sales_month &gt;= &#39;1993-01-01&#39; GROUP BY 1, 2 ORDER BY 1 B.2. Frame ë¬¸ë²• frameì ˆì€ ìœˆë„ìš° í•¨ìˆ˜ ì˜µì…˜ì„ í™œìš©í•´, ê° ìœˆë„ìš°ì—ì„œ ì–´ë–¤ ë ˆì½”ë“œë¥¼ í¬í•¨í• ì§€ ì§€ì •í•˜ëŠ” ë¬¸ë²• frame_endëŠ” ì•„ë˜ ì¤‘ í•˜ë‚˜ UNBOUNDED PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ ëª¨ë“  í–‰ offset PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ nê°œ í–‰ CURRENT ROW - í˜„ì¬ í–‰ offset FOLLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ nê°œ í–‰ UNBOUNDED FOLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ ëª¨ë“  í–‰ {range | row | group} BETWEEN frame_start AND frame_end SELECT sales_month, avg(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS moving_avg, COUNT(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS records FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; C. í¬ì†Œ ë°ì´í„°ì˜ ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ë‚ ì§œ ë£©ì—… í…Œì´ë¸” ì°¸ì¡°í•˜ì—¬ ì¿¼ë¦¬ SELECT d.date, avg(s.sales) AS moving_average, count(s.sales) AS records, max( CASE WHEN d.date = s.sales_month THEN s.sales END) AS sales_in_month FROM date_dim d JOIN ( SELECT sales_month, sales FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND month(sales_month) IN(1, 7)) s ON s.sales_month BETWEEN DATE_SUB(d.date, INTERVAL 11 MONTH) AND d.date WHERE d.date = d.first_day_of_month AND d.date BETWEEN &#39;1993-01-01&#39; AND &#39;2020-12-01&#39; GROUP BY 1 ORDER BY 1 D. ëˆ„ì ê°’ê°’ ê³„ì‚° D.1. YTD ìœˆë„ìš° ë¡¤ë§ SELECT sales_month, sales, sum(sales) OVER (PARTITION BY year(sales_month) ORDER BY sales_month) AS sales_ytd FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; ORDER BY 1 D.2. YTD ì„œë¸Œì¿¼ë¦¬ SELECT a.sales_month, a.sales, sum(b.sales) AS YTD_sales FROM retail_sales a JOIN retail_sales b ON year(a.sales_month) = year(b.sales_month) AND b.sales_month &lt;= a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; GROUP BY 1, 2 ORDER BY 1 E. ê³„ì ˆì„± ë¶„ì„ ì¼ì •í•œ ê°„ê²©ì„ ë‘ê³  ê·œì¹™ì ìœ¼ë¡œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ ì˜ë¯¸. ì—°ë‹¨ìœ„, í˜¹ì€ ë¶„ë‹¨ìœ„ë¡œ ë‚˜íƒ€ë‚˜ê¸°ë„ í•¨. E.1. lag í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì´ì „ê°’ ëŒ€ë¹„ ë¹„ìœ¨ ë³€í™” lag í•¨ìˆ˜ëŠ” ì´ì „í–‰ì˜ ê°’ì„ ë°˜í™˜í•œë‹¤. (lead = lagì™€ ë°˜ëŒ€. ë‹¤ìŒ í–‰ì„ ë°˜í™˜) offset ì˜µì…˜ : ëª‡ í–‰ ì´ì „ì˜ ê°’ì„ ë°˜í™˜í•  ê²ƒì¸ê°€? default ì˜µì…˜ : ì´ì „ í–‰ì´ ì—†ëŠ” ê²½ìš°ì— ë°˜í™˜í•  ê°’ PARTITION BY ì˜µì…˜ : ìƒëµ ì‹œ, ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•œ ê³„ì‚° ìˆ˜í–‰ ORDER BY ì˜µì…˜ : ìƒëµ ì‹œ, í˜„ì¬ db ì •ë ¬ ìˆœì„œë¡œ ê³„ì‚° ìˆ˜í–‰ êµ¬ê°„ë‹¨ìœ„ ê³„ì‚°ì€ ë³€í™”ë¥¼ ì´í•´í•˜ëŠ”ë° í™œìš©ë¨. ê³„ì ˆì„± ë¶„ì„í•˜ê¸°ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŒ. SELECT kind_of_business, sales_month, sales, lag(sales) OVER ( PARTITION BY kind_of_business ORDER BY sales_month ) AS t, (sales / (lag(sales) OVER (PARTITION BY kind_of_business ORDER BY sales_month)) - 1) * 100 AS pct_growth_then_prev FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39; E.2. êµ¬ê°„ ë¹„êµ : ì‘ë…„ ë™ì›”ê³¼ì˜ ë¹„êµ ì „ë…„ëŒ€ë¹„ ì„±ì¥ì„¸ë¥¼ ë¹„êµ. SELECT sales_month, sales, lag(sales_month) OVER (PARTITION BY month(sales_month) ORDER BY sales_month) AS prev_month, lag(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month) AS prev_sales, 100 * (sales / (lag(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month)) - 1) AS prev_pct FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39; E.3. êµ¬ê°„ ë¹„êµ : ë™ì›” ë¹„êµ. ì—°ë„ë³„ ì»¬ëŸ¼ í”¼ë²— ê° ì—°ë„ë³„ ì‹œê°ì  ë¹„êµì— ìš©ì´í•œ í”¼ë²— SELECT month(sales_month) as month_num, monthname(sales_month) as month_char, max(case when year(sales_month) = 1992 then sales end) as &#39;1992 sales&#39;, max(case when year(sales_month) = 1993 then sales end) as &#39;1993 sales&#39;, max(case when year(sales_month) = 1994 then sales end) as &#39;1994 sales&#39; FROM retail_sales WHERE kind_of_business like &#39;book%&#39; and sales_month between date(&#39;1992-01-01&#39;) and date(&#39;1994-12-01&#39;) group by 1,2 E.4. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ ì„œë¸Œì¿¼ë¦¬ ê³„ì‚°ì— í•˜ë‚˜ì˜ í–‰ì´ë¼ë„ null ì´ë©´ nullë¡œ ì²˜ë¦¬ë¨ì„ ìœ ì˜. SELECT sales_month,sales, sales/((a.prev_sales_1 + prev_sales_2 + prev_sales_3)/3) * 100 as pct FROM ( SELECT sales_month, sales, lag(sales,1) over (partition by month(sales_month) order by sales_month ) as prev_sales_1, lag(sales,2) over (partition by month(sales_month) order by sales_month ) as prev_sales_2, lag(sales,3) over (partition by month(sales_month) order by sales_month ) as prev_sales_3 FROM retail_sales WHERE kind_of_business like &#39;Book%&#39; ) as a E.5. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ í”„ë ˆì„ì ˆ ì„œë¸Œì¿¼ë¦¬ì™€ ê²°ê³¼ëŠ” ê°™ìœ¼ë‚˜, 1ê°œë¼ë„ nullì´ ì•„ë‹ˆë¼ë©´ ê³„ì‚° ìˆ˜í–‰ë¨ì„ ìœ ì˜ SELECT sales_month, sales, sales / avg(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) AS pct_pre FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39;" />
<meta property="og:description" content="PostgreSQLë¡œ ì‘ì„±ëœ ì„œì ì¸ OREILLYì˜ â€˜SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„â€™ì„ MySQLë¡œ ë³€í™˜í•˜ë©° ìŠ¤í„°ë””í•œ ë‚´ìš©. ì‹œê³„ì—´ ë¶„ì„ íŒŒíŠ¸ì˜ ë°ì´í„° í…Œì´ë¸” ì •ë¦¬ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë  í…Œì´ë¸” í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤. A. Table Scheme sales_month naics_code kind_f_business reason_for_null sales 1992-01-01 441 Motor vehicle and parts dealers Â  29811.00 1992-01-01 4411 Automobile dealers Â  25800.00 1992-01-01 4411, 4412 Automobile and other motor vehicle dealers Â  26788.00 1992-01-01 44111 New car dealers Â  24056.00 retail_sales í…Œì´ë¸” íŒë§¤ ì¼ì, ì†Œë§¤ ì—…ì¢…, íŒë§¤ì•¡ì´ ì ì¬ ë˜ì–´ìˆë‹¤. date date_key day_of_month day_of_year day_of_week day_name day_short_name week_number week_of_month week month_number month_name month+short_name first_day_of_month last_day_of_month quarter_number quarter_name first_day_of_quarter last_day_of_quarter year decade centurays 1770-01-01 17700101 1 1 1 Monday Mon 1 1 1770-01-01 1 January Jan 1770-01-01 1770-01-31 1 Q1 1770-01-01 1770-03-31 1770 1770 18 1770-01-02 17700102 2 2 2 Tuesday Tue 1 1 1770-01-01 1 January Jan 1770-01-01 1770-01-31 1 Q1 1770-01-01 1770-03-31 1770 1770 18 date_dim í…Œì´ë¸” ë¶„ì„ì— í™œìš©í•˜ê³ ì í•˜ëŠ” í…Œì´ë¸”ì— íŠ¹ì • ì¼ìì˜ ë ˆì½”ë“œê°€ ì‚­ì œë˜ì–´ ìˆë‹¤ë©´ ì§‘ê³„ ì‹œ í˜¼ë€ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì‚¬ê³ ë¥¼ ë¯¸ì—°ì— ë°©ì§€í•˜ê³ ì ë‚ ì§œ ë£©ì—… í…Œì´ë¸”ì„ ì •ì˜í•˜ê³ , í•„ìš” ì‹œ joiní•˜ì—¬ ê²°ì¸¡ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì§‘ê³„ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•œë‹¤. B. ë‚ ì§œê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚°ì„ í—·ê°ˆë¦¬ì§€ ë§ì. ë‚ ì§œ ê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚° ë‘ íƒ€ì…ì„ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì. ë‚ ì§œ ê°„ ê³„ì‚°ì€ ë¬¸ì ê·¸ëŒ€ë¡œ ì‚°ìˆ ì ì¸ ë‚ ì§œê°„ì˜ ì°¨ì´ë¥¼, ì¸í„°ë²Œì€ ê´€ë…ì ì¸(í•˜ì´ ë ˆë²¨ì—ì„œì˜) ë‚ ì§œì˜ ê°œë…ì—ì„œì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•œë‹¤. select date_add(date(&#39;2020-01-01&#39;), interval 1 week) ì‹œê³„ì—´ ë¶„ì„ - ë¹„ìœ¨ê³¼ ì°¨ì´ A. ì°¨ì´ ê³„ì‚°í•˜ê¸° A.1. ë‚¨ì—¬ ë§¤ì¶œ ì°¨ì´ Subquery ver subqueryë¥¼ í™œìš©í•œ ê³„ì‚° SELECT year(sales_month) AS years, a.womens_sales, a.mens_sales, a.womens_sales - a.mens_sales AS diff_sales FROM retail_sales, ( SELECT year(sales_month) AS years, sum( CASE WHEN kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; THEN sales END) AS womens_sales, sum( CASE WHEN kind_of_business = &#39;Men&#39;&#39;s clothing stores&#39; THEN sales END) AS mens_sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;, &#39;Men&#39;&#39;s clothing stores&#39;) GROUP BY 1) a B. ì „ì²´ ëŒ€ë¹„ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ê¸° B.1. subquery &amp; self joinì„ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚° SELECT sales_month, kind_of_business, sales, sales / aa.total_sales * 100 AS pct_total_sales FROM ( SELECT a.sales_month, a.kind_of_business, a.sales, sum(b.sales) AS total_sales FROM retail_sales a JOIN retail_sales b ON a.sales_month = b.sales_month AND b.kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) WHERE a.kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1, 2, 3) aa ORDER BY 1, 2 B.2. Partition by, sum ìœˆë„ìš°í•¨ìˆ˜ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚° partition by ì ˆë¡œ í•¨ìˆ˜ê°€ ê³„ì‚°í•˜ëŠ” í…Œì´ë¸”ì˜ ì„¹ì…˜ì„ êµ¬ë¶„ SELECT sales_month, kind_of_business, sales, sum(sales) OVER (PARTITION BY sales_month) AS total_sales, round(sales * 100 / sum(sales) OVER (PARTITION BY sales_month), 2) AS pct FROM retail_sales WHERE kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) ORDER BY 1, 2 C. ì—…ì¢…ë³„, ì—°ë§¤ì¶œ ëŒ€ë¹„ ì›”ê°„ ë§¤ì¶œ C.1. ì„œë¸Œì¿¼ë¦¬ í™œìš© SELECT rs.sales_month, rs.kind_of_business, SUM(rs.sales) AS sales_m, aa.sales_y, round(SUM(rs.sales) / aa.sales_y, 2) AS ratio_m_y FROM retail_sales rs JOIN ( SELECT YEAR(sales_month) AS sales_year, SUM(sales) AS sales_y, kind_of_business FROM retail_sales WHERE kind_of_business IN(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY sales_year, kind_of_business) aa ON YEAR(rs.sales_month) = aa.sales_year AND rs.kind_of_business = aa.kind_of_business WHERE rs.kind_of_business IN(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY rs.sales_month, rs.kind_of_business, aa.sales_y ORDER BY 1 C.2. ìœˆë„ìš° í•¨ìˆ˜ í™œìš© SELECT sales_month, kind_of_business, sales, sum(sales) OVER (PARTITION BY year(sales_month), kind_of_business) AS yearly_sales, sales * 100 / sum(sales) OVER (PARTITION BY year(sales_month), kind_of_business) AS pct_yearly FROM retail_sales WHERE kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) ORDER BY 1, 2; D. ì¸ë±ì‹±ìœ¼ë¡œ ì‹œê³„ì—´ ë°ì´í„° ë³€í™” ì´í•´í•˜ê¸° ë°ì´í„° ì¸ë±ì‹±ì€ ì‹œê³„ì—´ì—ì„œ ë² ì´ìŠ¤ êµ¬ê°„(ì‹œì‘ ì§€ì )ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì˜ ë³€í™”ëŸ‰ì„ ì´í•´í•˜ëŠ” ë°©ë²•. ì§‘ê³„í•¨ìˆ˜ì™€ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì¡°í•©í•˜ê±°ë‚˜ self-joinì„ í™œìš©í•¨. ìœˆë„ìš° í•¨ìˆ˜ê°€ ë§¤ìš° ìœ ì—°í•œ ì‚¬ìš©ì„±ì„ ë³´ì´ê¸°ì—, ì´ì— ìµìˆ™í•´ì§€ëŠ”ê²Œ ì¢‹ë‹¤. SELECT sales_year, sales, first_value(sales) OVER (ORDER BY sales_year) AS index_sales FROM ( SELECT year(sales_month) AS sales_year, sum(sales) AS sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1) a D.1. ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš©í•œ ì¸ë±ì‹± SELECT sales_year, sales, (sales / FIRST_VALUE(sales) OVER (ORDER BY sales_year) - 1) * 100 AS index_sales FROM ( SELECT year(sales_month) AS sales_year, sum(sales) AS sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1) a ì‹œê³„ì—´ ë¶„ì„ - ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ì§‘ê³„ì™€ëŠ” ë˜ ë‹¤ë¥¸ ë…¸ì´ì¦ˆ ì œê±° ë°©ë²•. ì—¬ëŸ¬ êµ¬ê°„ì„ ì„¤ì •í•´ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•˜ëŠ” ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ (=ì´ë™ ê³„ì‚°) ì‹œê³„ì—´ ë¡¤ë§ ê³„ì‚°ì˜ ìš”ì†ŒëŠ” 3ê°€ì§€. 1) ìœˆë„ìš° ì‚¬ì´ì¦ˆ, 2) ì§‘ê³„ í•¨ìˆ˜, 3) ìœˆë„ìš° ë‚´ ë°ì´í„°ì˜ ë¶„í•  í˜¹ì€ ê·¸ë£¹í™” ì…€í”„ì¡°ì¸ê³¼ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš© A. ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ëˆ„ì  í•© SELECT a.sales_month, a.sales, b.sales_month AS rolling_sales_month, b.sales AS rolling_sales FROM retail_sales a JOIN retail_sales b ON a.kind_of_business = b.kind_of_business AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 MONTH) AND a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND a.sales_month = date(&#39;2019-12-01&#39;) B. ì´ë™í‰ê· ì„  B.1. self join SELECT a.sales_month, a.sales, avg(b.sales) AS ma_1y, count(b.sales) AS records FROM retail_sales a JOIN retail_sales b ON a.kind_of_business = b.kind_of_business AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 month) AND a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND a.sales_month &gt;= &#39;1993-01-01&#39; GROUP BY 1, 2 ORDER BY 1 B.2. Frame ë¬¸ë²• frameì ˆì€ ìœˆë„ìš° í•¨ìˆ˜ ì˜µì…˜ì„ í™œìš©í•´, ê° ìœˆë„ìš°ì—ì„œ ì–´ë–¤ ë ˆì½”ë“œë¥¼ í¬í•¨í• ì§€ ì§€ì •í•˜ëŠ” ë¬¸ë²• frame_endëŠ” ì•„ë˜ ì¤‘ í•˜ë‚˜ UNBOUNDED PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ ëª¨ë“  í–‰ offset PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ nê°œ í–‰ CURRENT ROW - í˜„ì¬ í–‰ offset FOLLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ nê°œ í–‰ UNBOUNDED FOLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ ëª¨ë“  í–‰ {range | row | group} BETWEEN frame_start AND frame_end SELECT sales_month, avg(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS moving_avg, COUNT(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS records FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; C. í¬ì†Œ ë°ì´í„°ì˜ ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ë‚ ì§œ ë£©ì—… í…Œì´ë¸” ì°¸ì¡°í•˜ì—¬ ì¿¼ë¦¬ SELECT d.date, avg(s.sales) AS moving_average, count(s.sales) AS records, max( CASE WHEN d.date = s.sales_month THEN s.sales END) AS sales_in_month FROM date_dim d JOIN ( SELECT sales_month, sales FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND month(sales_month) IN(1, 7)) s ON s.sales_month BETWEEN DATE_SUB(d.date, INTERVAL 11 MONTH) AND d.date WHERE d.date = d.first_day_of_month AND d.date BETWEEN &#39;1993-01-01&#39; AND &#39;2020-12-01&#39; GROUP BY 1 ORDER BY 1 D. ëˆ„ì ê°’ê°’ ê³„ì‚° D.1. YTD ìœˆë„ìš° ë¡¤ë§ SELECT sales_month, sales, sum(sales) OVER (PARTITION BY year(sales_month) ORDER BY sales_month) AS sales_ytd FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; ORDER BY 1 D.2. YTD ì„œë¸Œì¿¼ë¦¬ SELECT a.sales_month, a.sales, sum(b.sales) AS YTD_sales FROM retail_sales a JOIN retail_sales b ON year(a.sales_month) = year(b.sales_month) AND b.sales_month &lt;= a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; GROUP BY 1, 2 ORDER BY 1 E. ê³„ì ˆì„± ë¶„ì„ ì¼ì •í•œ ê°„ê²©ì„ ë‘ê³  ê·œì¹™ì ìœ¼ë¡œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ ì˜ë¯¸. ì—°ë‹¨ìœ„, í˜¹ì€ ë¶„ë‹¨ìœ„ë¡œ ë‚˜íƒ€ë‚˜ê¸°ë„ í•¨. E.1. lag í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì´ì „ê°’ ëŒ€ë¹„ ë¹„ìœ¨ ë³€í™” lag í•¨ìˆ˜ëŠ” ì´ì „í–‰ì˜ ê°’ì„ ë°˜í™˜í•œë‹¤. (lead = lagì™€ ë°˜ëŒ€. ë‹¤ìŒ í–‰ì„ ë°˜í™˜) offset ì˜µì…˜ : ëª‡ í–‰ ì´ì „ì˜ ê°’ì„ ë°˜í™˜í•  ê²ƒì¸ê°€? default ì˜µì…˜ : ì´ì „ í–‰ì´ ì—†ëŠ” ê²½ìš°ì— ë°˜í™˜í•  ê°’ PARTITION BY ì˜µì…˜ : ìƒëµ ì‹œ, ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•œ ê³„ì‚° ìˆ˜í–‰ ORDER BY ì˜µì…˜ : ìƒëµ ì‹œ, í˜„ì¬ db ì •ë ¬ ìˆœì„œë¡œ ê³„ì‚° ìˆ˜í–‰ êµ¬ê°„ë‹¨ìœ„ ê³„ì‚°ì€ ë³€í™”ë¥¼ ì´í•´í•˜ëŠ”ë° í™œìš©ë¨. ê³„ì ˆì„± ë¶„ì„í•˜ê¸°ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŒ. SELECT kind_of_business, sales_month, sales, lag(sales) OVER ( PARTITION BY kind_of_business ORDER BY sales_month ) AS t, (sales / (lag(sales) OVER (PARTITION BY kind_of_business ORDER BY sales_month)) - 1) * 100 AS pct_growth_then_prev FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39; E.2. êµ¬ê°„ ë¹„êµ : ì‘ë…„ ë™ì›”ê³¼ì˜ ë¹„êµ ì „ë…„ëŒ€ë¹„ ì„±ì¥ì„¸ë¥¼ ë¹„êµ. SELECT sales_month, sales, lag(sales_month) OVER (PARTITION BY month(sales_month) ORDER BY sales_month) AS prev_month, lag(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month) AS prev_sales, 100 * (sales / (lag(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month)) - 1) AS prev_pct FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39; E.3. êµ¬ê°„ ë¹„êµ : ë™ì›” ë¹„êµ. ì—°ë„ë³„ ì»¬ëŸ¼ í”¼ë²— ê° ì—°ë„ë³„ ì‹œê°ì  ë¹„êµì— ìš©ì´í•œ í”¼ë²— SELECT month(sales_month) as month_num, monthname(sales_month) as month_char, max(case when year(sales_month) = 1992 then sales end) as &#39;1992 sales&#39;, max(case when year(sales_month) = 1993 then sales end) as &#39;1993 sales&#39;, max(case when year(sales_month) = 1994 then sales end) as &#39;1994 sales&#39; FROM retail_sales WHERE kind_of_business like &#39;book%&#39; and sales_month between date(&#39;1992-01-01&#39;) and date(&#39;1994-12-01&#39;) group by 1,2 E.4. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ ì„œë¸Œì¿¼ë¦¬ ê³„ì‚°ì— í•˜ë‚˜ì˜ í–‰ì´ë¼ë„ null ì´ë©´ nullë¡œ ì²˜ë¦¬ë¨ì„ ìœ ì˜. SELECT sales_month,sales, sales/((a.prev_sales_1 + prev_sales_2 + prev_sales_3)/3) * 100 as pct FROM ( SELECT sales_month, sales, lag(sales,1) over (partition by month(sales_month) order by sales_month ) as prev_sales_1, lag(sales,2) over (partition by month(sales_month) order by sales_month ) as prev_sales_2, lag(sales,3) over (partition by month(sales_month) order by sales_month ) as prev_sales_3 FROM retail_sales WHERE kind_of_business like &#39;Book%&#39; ) as a E.5. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ í”„ë ˆì„ì ˆ ì„œë¸Œì¿¼ë¦¬ì™€ ê²°ê³¼ëŠ” ê°™ìœ¼ë‚˜, 1ê°œë¼ë„ nullì´ ì•„ë‹ˆë¼ë©´ ê³„ì‚° ìˆ˜í–‰ë¨ì„ ìœ ì˜ SELECT sales_month, sales, sales / avg(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) AS pct_pre FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39;" />
<link rel="canonical" href="http://localhost:4000/articles/2023/06/01/%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%B6%84%EC%84%9D-SQL%EB%A1%9C-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D-MySQL" />
<meta property="og:url" content="http://localhost:4000/articles/2023/06/01/%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%B6%84%EC%84%9D-SQL%EB%A1%9C-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D-MySQL" />
<meta property="og:site_name" content="Data Archive Doyle" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-01T15:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ì‹œê³„ì—´ ë¶„ì„ - SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„ MySQL" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Doyle"},"dateModified":"2023-06-01T15:00:00+09:00","datePublished":"2023-06-01T15:00:00+09:00","description":"PostgreSQLë¡œ ì‘ì„±ëœ ì„œì ì¸ OREILLYì˜ â€˜SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„â€™ì„ MySQLë¡œ ë³€í™˜í•˜ë©° ìŠ¤í„°ë””í•œ ë‚´ìš©. ì‹œê³„ì—´ ë¶„ì„ íŒŒíŠ¸ì˜ ë°ì´í„° í…Œì´ë¸” ì •ë¦¬ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë  í…Œì´ë¸” í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤. A. Table Scheme sales_month naics_code kind_f_business reason_for_null sales 1992-01-01 441 Motor vehicle and parts dealers Â  29811.00 1992-01-01 4411 Automobile dealers Â  25800.00 1992-01-01 4411, 4412 Automobile and other motor vehicle dealers Â  26788.00 1992-01-01 44111 New car dealers Â  24056.00 retail_sales í…Œì´ë¸” íŒë§¤ ì¼ì, ì†Œë§¤ ì—…ì¢…, íŒë§¤ì•¡ì´ ì ì¬ ë˜ì–´ìˆë‹¤. date date_key day_of_month day_of_year day_of_week day_name day_short_name week_number week_of_month week month_number month_name month+short_name first_day_of_month last_day_of_month quarter_number quarter_name first_day_of_quarter last_day_of_quarter year decade centurays 1770-01-01 17700101 1 1 1 Monday Mon 1 1 1770-01-01 1 January Jan 1770-01-01 1770-01-31 1 Q1 1770-01-01 1770-03-31 1770 1770 18 1770-01-02 17700102 2 2 2 Tuesday Tue 1 1 1770-01-01 1 January Jan 1770-01-01 1770-01-31 1 Q1 1770-01-01 1770-03-31 1770 1770 18 date_dim í…Œì´ë¸” ë¶„ì„ì— í™œìš©í•˜ê³ ì í•˜ëŠ” í…Œì´ë¸”ì— íŠ¹ì • ì¼ìì˜ ë ˆì½”ë“œê°€ ì‚­ì œë˜ì–´ ìˆë‹¤ë©´ ì§‘ê³„ ì‹œ í˜¼ë€ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì‚¬ê³ ë¥¼ ë¯¸ì—°ì— ë°©ì§€í•˜ê³ ì ë‚ ì§œ ë£©ì—… í…Œì´ë¸”ì„ ì •ì˜í•˜ê³ , í•„ìš” ì‹œ joiní•˜ì—¬ ê²°ì¸¡ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì§‘ê³„ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•œë‹¤. B. ë‚ ì§œê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚°ì„ í—·ê°ˆë¦¬ì§€ ë§ì. ë‚ ì§œ ê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚° ë‘ íƒ€ì…ì„ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì. ë‚ ì§œ ê°„ ê³„ì‚°ì€ ë¬¸ì ê·¸ëŒ€ë¡œ ì‚°ìˆ ì ì¸ ë‚ ì§œê°„ì˜ ì°¨ì´ë¥¼, ì¸í„°ë²Œì€ ê´€ë…ì ì¸(í•˜ì´ ë ˆë²¨ì—ì„œì˜) ë‚ ì§œì˜ ê°œë…ì—ì„œì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•œë‹¤. select date_add(date(&#39;2020-01-01&#39;), interval 1 week) ì‹œê³„ì—´ ë¶„ì„ - ë¹„ìœ¨ê³¼ ì°¨ì´ A. ì°¨ì´ ê³„ì‚°í•˜ê¸° A.1. ë‚¨ì—¬ ë§¤ì¶œ ì°¨ì´ Subquery ver subqueryë¥¼ í™œìš©í•œ ê³„ì‚° SELECT year(sales_month) AS years, a.womens_sales, a.mens_sales, a.womens_sales - a.mens_sales AS diff_sales FROM retail_sales, ( SELECT year(sales_month) AS years, sum( CASE WHEN kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; THEN sales END) AS womens_sales, sum( CASE WHEN kind_of_business = &#39;Men&#39;&#39;s clothing stores&#39; THEN sales END) AS mens_sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;, &#39;Men&#39;&#39;s clothing stores&#39;) GROUP BY 1) a B. ì „ì²´ ëŒ€ë¹„ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ê¸° B.1. subquery &amp; self joinì„ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚° SELECT sales_month, kind_of_business, sales, sales / aa.total_sales * 100 AS pct_total_sales FROM ( SELECT a.sales_month, a.kind_of_business, a.sales, sum(b.sales) AS total_sales FROM retail_sales a JOIN retail_sales b ON a.sales_month = b.sales_month AND b.kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) WHERE a.kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1, 2, 3) aa ORDER BY 1, 2 B.2. Partition by, sum ìœˆë„ìš°í•¨ìˆ˜ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚° partition by ì ˆë¡œ í•¨ìˆ˜ê°€ ê³„ì‚°í•˜ëŠ” í…Œì´ë¸”ì˜ ì„¹ì…˜ì„ êµ¬ë¶„ SELECT sales_month, kind_of_business, sales, sum(sales) OVER (PARTITION BY sales_month) AS total_sales, round(sales * 100 / sum(sales) OVER (PARTITION BY sales_month), 2) AS pct FROM retail_sales WHERE kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) ORDER BY 1, 2 C. ì—…ì¢…ë³„, ì—°ë§¤ì¶œ ëŒ€ë¹„ ì›”ê°„ ë§¤ì¶œ C.1. ì„œë¸Œì¿¼ë¦¬ í™œìš© SELECT rs.sales_month, rs.kind_of_business, SUM(rs.sales) AS sales_m, aa.sales_y, round(SUM(rs.sales) / aa.sales_y, 2) AS ratio_m_y FROM retail_sales rs JOIN ( SELECT YEAR(sales_month) AS sales_year, SUM(sales) AS sales_y, kind_of_business FROM retail_sales WHERE kind_of_business IN(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY sales_year, kind_of_business) aa ON YEAR(rs.sales_month) = aa.sales_year AND rs.kind_of_business = aa.kind_of_business WHERE rs.kind_of_business IN(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY rs.sales_month, rs.kind_of_business, aa.sales_y ORDER BY 1 C.2. ìœˆë„ìš° í•¨ìˆ˜ í™œìš© SELECT sales_month, kind_of_business, sales, sum(sales) OVER (PARTITION BY year(sales_month), kind_of_business) AS yearly_sales, sales * 100 / sum(sales) OVER (PARTITION BY year(sales_month), kind_of_business) AS pct_yearly FROM retail_sales WHERE kind_of_business in(&#39;Men&#39;&#39;s clothing stores&#39;, &#39;Women&#39;&#39;s clothing stores&#39;) ORDER BY 1, 2; D. ì¸ë±ì‹±ìœ¼ë¡œ ì‹œê³„ì—´ ë°ì´í„° ë³€í™” ì´í•´í•˜ê¸° ë°ì´í„° ì¸ë±ì‹±ì€ ì‹œê³„ì—´ì—ì„œ ë² ì´ìŠ¤ êµ¬ê°„(ì‹œì‘ ì§€ì )ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì˜ ë³€í™”ëŸ‰ì„ ì´í•´í•˜ëŠ” ë°©ë²•. ì§‘ê³„í•¨ìˆ˜ì™€ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì¡°í•©í•˜ê±°ë‚˜ self-joinì„ í™œìš©í•¨. ìœˆë„ìš° í•¨ìˆ˜ê°€ ë§¤ìš° ìœ ì—°í•œ ì‚¬ìš©ì„±ì„ ë³´ì´ê¸°ì—, ì´ì— ìµìˆ™í•´ì§€ëŠ”ê²Œ ì¢‹ë‹¤. SELECT sales_year, sales, first_value(sales) OVER (ORDER BY sales_year) AS index_sales FROM ( SELECT year(sales_month) AS sales_year, sum(sales) AS sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1) a D.1. ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš©í•œ ì¸ë±ì‹± SELECT sales_year, sales, (sales / FIRST_VALUE(sales) OVER (ORDER BY sales_year) - 1) * 100 AS index_sales FROM ( SELECT year(sales_month) AS sales_year, sum(sales) AS sales FROM retail_sales WHERE kind_of_business in(&#39;Women&#39;&#39;s clothing stores&#39;) GROUP BY 1) a ì‹œê³„ì—´ ë¶„ì„ - ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ì§‘ê³„ì™€ëŠ” ë˜ ë‹¤ë¥¸ ë…¸ì´ì¦ˆ ì œê±° ë°©ë²•. ì—¬ëŸ¬ êµ¬ê°„ì„ ì„¤ì •í•´ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•˜ëŠ” ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ (=ì´ë™ ê³„ì‚°) ì‹œê³„ì—´ ë¡¤ë§ ê³„ì‚°ì˜ ìš”ì†ŒëŠ” 3ê°€ì§€. 1) ìœˆë„ìš° ì‚¬ì´ì¦ˆ, 2) ì§‘ê³„ í•¨ìˆ˜, 3) ìœˆë„ìš° ë‚´ ë°ì´í„°ì˜ ë¶„í•  í˜¹ì€ ê·¸ë£¹í™” ì…€í”„ì¡°ì¸ê³¼ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš© A. ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ëˆ„ì  í•© SELECT a.sales_month, a.sales, b.sales_month AS rolling_sales_month, b.sales AS rolling_sales FROM retail_sales a JOIN retail_sales b ON a.kind_of_business = b.kind_of_business AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 MONTH) AND a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND a.sales_month = date(&#39;2019-12-01&#39;) B. ì´ë™í‰ê· ì„  B.1. self join SELECT a.sales_month, a.sales, avg(b.sales) AS ma_1y, count(b.sales) AS records FROM retail_sales a JOIN retail_sales b ON a.kind_of_business = b.kind_of_business AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 month) AND a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND a.sales_month &gt;= &#39;1993-01-01&#39; GROUP BY 1, 2 ORDER BY 1 B.2. Frame ë¬¸ë²• frameì ˆì€ ìœˆë„ìš° í•¨ìˆ˜ ì˜µì…˜ì„ í™œìš©í•´, ê° ìœˆë„ìš°ì—ì„œ ì–´ë–¤ ë ˆì½”ë“œë¥¼ í¬í•¨í• ì§€ ì§€ì •í•˜ëŠ” ë¬¸ë²• frame_endëŠ” ì•„ë˜ ì¤‘ í•˜ë‚˜ UNBOUNDED PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ ëª¨ë“  í–‰ offset PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ nê°œ í–‰ CURRENT ROW - í˜„ì¬ í–‰ offset FOLLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ nê°œ í–‰ UNBOUNDED FOLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ ëª¨ë“  í–‰ {range | row | group} BETWEEN frame_start AND frame_end SELECT sales_month, avg(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS moving_avg, COUNT(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS records FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; C. í¬ì†Œ ë°ì´í„°ì˜ ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ë‚ ì§œ ë£©ì—… í…Œì´ë¸” ì°¸ì¡°í•˜ì—¬ ì¿¼ë¦¬ SELECT d.date, avg(s.sales) AS moving_average, count(s.sales) AS records, max( CASE WHEN d.date = s.sales_month THEN s.sales END) AS sales_in_month FROM date_dim d JOIN ( SELECT sales_month, sales FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; AND month(sales_month) IN(1, 7)) s ON s.sales_month BETWEEN DATE_SUB(d.date, INTERVAL 11 MONTH) AND d.date WHERE d.date = d.first_day_of_month AND d.date BETWEEN &#39;1993-01-01&#39; AND &#39;2020-12-01&#39; GROUP BY 1 ORDER BY 1 D. ëˆ„ì ê°’ê°’ ê³„ì‚° D.1. YTD ìœˆë„ìš° ë¡¤ë§ SELECT sales_month, sales, sum(sales) OVER (PARTITION BY year(sales_month) ORDER BY sales_month) AS sales_ytd FROM retail_sales WHERE kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; ORDER BY 1 D.2. YTD ì„œë¸Œì¿¼ë¦¬ SELECT a.sales_month, a.sales, sum(b.sales) AS YTD_sales FROM retail_sales a JOIN retail_sales b ON year(a.sales_month) = year(b.sales_month) AND b.sales_month &lt;= a.sales_month AND b.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; WHERE a.kind_of_business = &#39;Women&#39;&#39;s clothing stores&#39; GROUP BY 1, 2 ORDER BY 1 E. ê³„ì ˆì„± ë¶„ì„ ì¼ì •í•œ ê°„ê²©ì„ ë‘ê³  ê·œì¹™ì ìœ¼ë¡œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ ì˜ë¯¸. ì—°ë‹¨ìœ„, í˜¹ì€ ë¶„ë‹¨ìœ„ë¡œ ë‚˜íƒ€ë‚˜ê¸°ë„ í•¨. E.1. lag í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì´ì „ê°’ ëŒ€ë¹„ ë¹„ìœ¨ ë³€í™” lag í•¨ìˆ˜ëŠ” ì´ì „í–‰ì˜ ê°’ì„ ë°˜í™˜í•œë‹¤. (lead = lagì™€ ë°˜ëŒ€. ë‹¤ìŒ í–‰ì„ ë°˜í™˜) offset ì˜µì…˜ : ëª‡ í–‰ ì´ì „ì˜ ê°’ì„ ë°˜í™˜í•  ê²ƒì¸ê°€? default ì˜µì…˜ : ì´ì „ í–‰ì´ ì—†ëŠ” ê²½ìš°ì— ë°˜í™˜í•  ê°’ PARTITION BY ì˜µì…˜ : ìƒëµ ì‹œ, ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•œ ê³„ì‚° ìˆ˜í–‰ ORDER BY ì˜µì…˜ : ìƒëµ ì‹œ, í˜„ì¬ db ì •ë ¬ ìˆœì„œë¡œ ê³„ì‚° ìˆ˜í–‰ êµ¬ê°„ë‹¨ìœ„ ê³„ì‚°ì€ ë³€í™”ë¥¼ ì´í•´í•˜ëŠ”ë° í™œìš©ë¨. ê³„ì ˆì„± ë¶„ì„í•˜ê¸°ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŒ. SELECT kind_of_business, sales_month, sales, lag(sales) OVER ( PARTITION BY kind_of_business ORDER BY sales_month ) AS t, (sales / (lag(sales) OVER (PARTITION BY kind_of_business ORDER BY sales_month)) - 1) * 100 AS pct_growth_then_prev FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39; E.2. êµ¬ê°„ ë¹„êµ : ì‘ë…„ ë™ì›”ê³¼ì˜ ë¹„êµ ì „ë…„ëŒ€ë¹„ ì„±ì¥ì„¸ë¥¼ ë¹„êµ. SELECT sales_month, sales, lag(sales_month) OVER (PARTITION BY month(sales_month) ORDER BY sales_month) AS prev_month, lag(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month) AS prev_sales, 100 * (sales / (lag(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month)) - 1) AS prev_pct FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39; E.3. êµ¬ê°„ ë¹„êµ : ë™ì›” ë¹„êµ. ì—°ë„ë³„ ì»¬ëŸ¼ í”¼ë²— ê° ì—°ë„ë³„ ì‹œê°ì  ë¹„êµì— ìš©ì´í•œ í”¼ë²— SELECT month(sales_month) as month_num, monthname(sales_month) as month_char, max(case when year(sales_month) = 1992 then sales end) as &#39;1992 sales&#39;, max(case when year(sales_month) = 1993 then sales end) as &#39;1993 sales&#39;, max(case when year(sales_month) = 1994 then sales end) as &#39;1994 sales&#39; FROM retail_sales WHERE kind_of_business like &#39;book%&#39; and sales_month between date(&#39;1992-01-01&#39;) and date(&#39;1994-12-01&#39;) group by 1,2 E.4. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ ì„œë¸Œì¿¼ë¦¬ ê³„ì‚°ì— í•˜ë‚˜ì˜ í–‰ì´ë¼ë„ null ì´ë©´ nullë¡œ ì²˜ë¦¬ë¨ì„ ìœ ì˜. SELECT sales_month,sales, sales/((a.prev_sales_1 + prev_sales_2 + prev_sales_3)/3) * 100 as pct FROM ( SELECT sales_month, sales, lag(sales,1) over (partition by month(sales_month) order by sales_month ) as prev_sales_1, lag(sales,2) over (partition by month(sales_month) order by sales_month ) as prev_sales_2, lag(sales,3) over (partition by month(sales_month) order by sales_month ) as prev_sales_3 FROM retail_sales WHERE kind_of_business like &#39;Book%&#39; ) as a E.5. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ í”„ë ˆì„ì ˆ ì„œë¸Œì¿¼ë¦¬ì™€ ê²°ê³¼ëŠ” ê°™ìœ¼ë‚˜, 1ê°œë¼ë„ nullì´ ì•„ë‹ˆë¼ë©´ ê³„ì‚° ìˆ˜í–‰ë¨ì„ ìœ ì˜ SELECT sales_month, sales, sales / avg(sales) OVER (PARTITION BY month(sales_month) ORDER BY sales_month ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) AS pct_pre FROM retail_sales WHERE kind_of_business LIKE &#39;Book%&#39;","headline":"ì‹œê³„ì—´ ë¶„ì„ - SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„ MySQL","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/articles/2023/06/01/%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%B6%84%EC%84%9D-SQL%EB%A1%9C-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D-MySQL"},"url":"http://localhost:4000/articles/2023/06/01/%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%B6%84%EC%84%9D-SQL%EB%A1%9C-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D-MySQL"}</script>
<!-- End Jekyll SEO tag -->

  
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
              // ...options...
          });
      });
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/articles/2023/06/01/%E1%84%89%E1%85%B5%E1%84%80%E1%85%A8%E1%84%8B%E1%85%A7%E1%86%AF-%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8-SQL%E1%84%85%E1%85%A9-%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%82%E1%85%B3%E1%86%AB-%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5-%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8-MySQL">
  <link rel="alternate" type="application/rss+xml" title="Data Archive | Doyle" href="http://localhost:4000/feed.xml">
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">

  <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-UA-185737211-1"></script> -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-185737211-1');
  </script>
</head>

  
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
  
  <body>
    <header class="site-header">

  <div class="wrapper">
    <a class="site-title" style="text-decoration: none" href="/">
<!--       &lt;:]{%&gt; == []{} -->
<!--      &lt;<span style="color: #ff5400;">daegikim</span>.github.io/&gt;-->
        Doyle, DA
        <span style="display: inline-block" class=" animated bounceIn">ğŸš€</span>
    </a>
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
           
          <a class="page-link" href="/about">About</a>
          
          <a class="page-link" href="/">Blog</a>
                                               
      </div>
    </nav>
  </div>
</header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/math...">
    </script>

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">ì‹œê³„ì—´ ë¶„ì„ - SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„ MySQL</h1>
    <p class="post-meta">
      <span class="left">
        <time datetime="2023-06-01T15:00:00+09:00" itemprop="datePublished">Jun 1, 2023</time>
       <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Doyle</span></span>
      </span>
      <span class="right">
        <span class="post-author-image" style="background-image:url(/assets/images/conan.png);"></span>
      </span>
    </p>
  </header>
  <div class="post-content" itemprop="articleBody">
    <p>PostgreSQLë¡œ ì‘ì„±ëœ ì„œì ì¸ OREILLYì˜ â€˜SQLë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ë¶„ì„â€™ì„ MySQLë¡œ ë³€í™˜í•˜ë©° ìŠ¤í„°ë””í•œ ë‚´ìš©.</p>

<h2 id="ì‹œê³„ì—´-ë¶„ì„-íŒŒíŠ¸ì˜-ë°ì´í„°-í…Œì´ë¸”-ì •ë¦¬">ì‹œê³„ì—´ ë¶„ì„ íŒŒíŠ¸ì˜ ë°ì´í„° í…Œì´ë¸” ì •ë¦¬</h2>
<p>ì¿¼ë¦¬ê°€ ì‹¤í–‰ë  í…Œì´ë¸” í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>
<h3 id="a-table-scheme">A. Table Scheme</h3>

<table>
  <thead>
    <tr>
      <th>sales_month</th>
      <th>naics_code</th>
      <th>kind_f_business</th>
      <th>reason_for_null</th>
      <th>sales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1992-01-01</td>
      <td>441</td>
      <td>Motor vehicle and parts dealers</td>
      <td>Â </td>
      <td>29811.00</td>
    </tr>
    <tr>
      <td>1992-01-01</td>
      <td>4411</td>
      <td>Automobile dealers</td>
      <td>Â </td>
      <td>25800.00</td>
    </tr>
    <tr>
      <td>1992-01-01</td>
      <td>4411, 4412</td>
      <td>Automobile and other motor vehicle dealers</td>
      <td>Â </td>
      <td>26788.00</td>
    </tr>
    <tr>
      <td>1992-01-01</td>
      <td>44111</td>
      <td>New car dealers</td>
      <td>Â </td>
      <td>24056.00</td>
    </tr>
  </tbody>
</table>

<p><strong>retail_sales í…Œì´ë¸”</strong></p>
<ul>
  <li>íŒë§¤ ì¼ì, ì†Œë§¤ ì—…ì¢…, íŒë§¤ì•¡ì´ ì ì¬ ë˜ì–´ìˆë‹¤.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>date</th>
      <th>date_key</th>
      <th>day_of_month</th>
      <th>day_of_year</th>
      <th>day_of_week</th>
      <th>day_name</th>
      <th>day_short_name</th>
      <th>week_number</th>
      <th>week_of_month</th>
      <th>week</th>
      <th>month_number</th>
      <th>month_name</th>
      <th>month+short_name</th>
      <th>first_day_of_month</th>
      <th>last_day_of_month</th>
      <th>quarter_number</th>
      <th>quarter_name</th>
      <th>first_day_of_quarter</th>
      <th>last_day_of_quarter</th>
      <th>year</th>
      <th>decade</th>
      <th>centurays</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1770-01-01</td>
      <td>17700101</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>Monday</td>
      <td>Mon</td>
      <td>1</td>
      <td>1</td>
      <td>1770-01-01</td>
      <td>1</td>
      <td>January</td>
      <td>Jan</td>
      <td>1770-01-01</td>
      <td>1770-01-31</td>
      <td>1</td>
      <td>Q1</td>
      <td>1770-01-01</td>
      <td>1770-03-31</td>
      <td>1770</td>
      <td>1770</td>
      <td>18</td>
    </tr>
    <tr>
      <td>1770-01-02</td>
      <td>17700102</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>Tuesday</td>
      <td>Tue</td>
      <td>1</td>
      <td>1</td>
      <td>1770-01-01</td>
      <td>1</td>
      <td>January</td>
      <td>Jan</td>
      <td>1770-01-01</td>
      <td>1770-01-31</td>
      <td>1</td>
      <td>Q1</td>
      <td>1770-01-01</td>
      <td>1770-03-31</td>
      <td>1770</td>
      <td>1770</td>
      <td>18</td>
    </tr>
  </tbody>
</table>

<p><strong>date_dim í…Œì´ë¸”</strong></p>
<ul>
  <li>ë¶„ì„ì— í™œìš©í•˜ê³ ì í•˜ëŠ” í…Œì´ë¸”ì— íŠ¹ì • ì¼ìì˜ ë ˆì½”ë“œê°€ ì‚­ì œë˜ì–´ ìˆë‹¤ë©´ ì§‘ê³„ ì‹œ í˜¼ë€ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</li>
  <li>ì´ëŸ¬í•œ ì‚¬ê³ ë¥¼ ë¯¸ì—°ì— ë°©ì§€í•˜ê³ ì ë‚ ì§œ ë£©ì—… í…Œì´ë¸”ì„ ì •ì˜í•˜ê³ , í•„ìš” ì‹œ joiní•˜ì—¬ ê²°ì¸¡ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì§‘ê³„ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•œë‹¤.</li>
</ul>

<h3 id="b-ë‚ ì§œê°„-ê³„ì‚°ê³¼-ì¸í„°ë²Œ-ê³„ì‚°ì„-í—·ê°ˆë¦¬ì§€-ë§ì">B. ë‚ ì§œê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚°ì„ í—·ê°ˆë¦¬ì§€ ë§ì.</h3>
<p>ë‚ ì§œ ê°„ ê³„ì‚°ê³¼ ì¸í„°ë²Œ ê³„ì‚° ë‘ íƒ€ì…ì„ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì. ë‚ ì§œ ê°„ ê³„ì‚°ì€ ë¬¸ì ê·¸ëŒ€ë¡œ ì‚°ìˆ ì ì¸ ë‚ ì§œê°„ì˜ ì°¨ì´ë¥¼, ì¸í„°ë²Œì€ ê´€ë…ì ì¸(í•˜ì´ ë ˆë²¨ì—ì„œì˜) ë‚ ì§œì˜ ê°œë…ì—ì„œì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•œë‹¤.</p>
<pre><code class="language-sql">select date_add(date('2020-01-01'), interval 1 week)
</code></pre>

<h2 id="ì‹œê³„ì—´-ë¶„ì„---ë¹„ìœ¨ê³¼-ì°¨ì´">ì‹œê³„ì—´ ë¶„ì„ - ë¹„ìœ¨ê³¼ ì°¨ì´</h2>

<h3 id="a-ì°¨ì´-ê³„ì‚°í•˜ê¸°">A. ì°¨ì´ ê³„ì‚°í•˜ê¸°</h3>
<h4 id="a1-ë‚¨ì—¬-ë§¤ì¶œ-ì°¨ì´-subquery-ver">A.1. ë‚¨ì—¬ ë§¤ì¶œ ì°¨ì´ Subquery ver</h4>
<p>subqueryë¥¼ í™œìš©í•œ ê³„ì‚°</p>
<pre><code class="language-sql">SELECT
	year(sales_month) AS years,
	a.womens_sales,
	a.mens_sales,
	a.womens_sales - a.mens_sales AS diff_sales
FROM
	retail_sales,
	(
		SELECT
			year(sales_month) AS years,
			sum(
				CASE WHEN kind_of_business = 'Women''s clothing stores' THEN
					sales
				END) AS womens_sales,
			sum(
				CASE WHEN kind_of_business = 'Men''s clothing stores' THEN
					sales
				END) AS mens_sales
		FROM
			retail_sales
		WHERE
			kind_of_business in('Women''s clothing stores', 'Men''s clothing stores')
		GROUP BY
			1) a
</code></pre>
<p><img src="https://i.imgur.com/GcRJNEQ.png" alt="" /></p>

<h3 id="b-ì „ì²´-ëŒ€ë¹„-ë¹„ìœ¨ì„-ê³„ì‚°í•˜ê¸°">B. ì „ì²´ ëŒ€ë¹„ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ê¸°</h3>
<h4 id="b1-subquery--self-joinì„-í™œìš©í•œ-ë¹„ìœ¨-ê³„ì‚°">B.1. subquery &amp; self joinì„ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚°</h4>
<pre><code class="language-sql">SELECT
	sales_month,
	kind_of_business,
	sales,
	sales / aa.total_sales * 100 AS pct_total_sales
FROM (
	SELECT
		a.sales_month,
		a.kind_of_business,
		a.sales,
		sum(b.sales) AS total_sales
	FROM
		retail_sales a
		JOIN retail_sales b ON a.sales_month = b.sales_month
			AND b.kind_of_business in('Men''s clothing stores', 'Women''s clothing stores')
	WHERE
		a.kind_of_business in('Men''s clothing stores', 'Women''s clothing stores')
	GROUP BY
		1,
		2,
		3) aa
ORDER BY
	1,
	2
</code></pre>

<h4 id="b2-partition-by-sum-ìœˆë„ìš°í•¨ìˆ˜-í™œìš©í•œ-ë¹„ìœ¨-ê³„ì‚°">B.2. Partition by, sum ìœˆë„ìš°í•¨ìˆ˜ í™œìš©í•œ ë¹„ìœ¨ ê³„ì‚°</h4>
<p>partition by ì ˆë¡œ í•¨ìˆ˜ê°€ ê³„ì‚°í•˜ëŠ” í…Œì´ë¸”ì˜ ì„¹ì…˜ì„ êµ¬ë¶„</p>
<pre><code class="language-sql">SELECT
	sales_month,
	kind_of_business,
	sales,
	sum(sales) OVER (PARTITION BY sales_month) AS total_sales,
	round(sales * 100 / sum(sales) OVER (PARTITION BY sales_month), 2) AS pct
FROM
	retail_sales
WHERE
	kind_of_business in('Men''s clothing stores', 'Women''s clothing stores')
ORDER BY
	1,
	2
</code></pre>

<p><img src="https://i.imgur.com/hMxp250.png" alt="" /></p>

<h3 id="c-ì—…ì¢…ë³„-ì—°ë§¤ì¶œ-ëŒ€ë¹„-ì›”ê°„-ë§¤ì¶œ">C. ì—…ì¢…ë³„, ì—°ë§¤ì¶œ ëŒ€ë¹„ ì›”ê°„ ë§¤ì¶œ</h3>
<h4 id="c1-ì„œë¸Œì¿¼ë¦¬-í™œìš©">C.1. ì„œë¸Œì¿¼ë¦¬ í™œìš©</h4>
<pre><code class="language-sql">SELECT
	rs.sales_month,
	rs.kind_of_business,
	SUM(rs.sales) AS sales_m,
	aa.sales_y,
	round(SUM(rs.sales) / aa.sales_y, 2) AS ratio_m_y
FROM
	retail_sales rs
	JOIN (
		SELECT
			YEAR(sales_month) AS sales_year,
			SUM(sales) AS sales_y,
			kind_of_business
		FROM
			retail_sales
		WHERE
			kind_of_business IN('Men''s clothing stores', 'Women''s clothing stores')
		GROUP BY
			sales_year,
			kind_of_business) aa ON YEAR(rs.sales_month) = aa.sales_year
	AND rs.kind_of_business = aa.kind_of_business
WHERE
	rs.kind_of_business IN('Men''s clothing stores', 'Women''s clothing stores')
GROUP BY
	rs.sales_month,
	rs.kind_of_business,
	aa.sales_y
ORDER BY
	1
</code></pre>
<h4 id="c2-ìœˆë„ìš°-í•¨ìˆ˜-í™œìš©">C.2. ìœˆë„ìš° í•¨ìˆ˜ í™œìš©</h4>
<pre><code class="language-sql">SELECT
	sales_month,
	kind_of_business,
	sales,
	sum(sales) OVER (PARTITION BY year(sales_month),
		kind_of_business) AS yearly_sales,
	sales * 100 / sum(sales) OVER (PARTITION BY year(sales_month),
		kind_of_business) AS pct_yearly
FROM
	retail_sales
WHERE
	kind_of_business in('Men''s clothing stores', 'Women''s clothing stores')
ORDER BY
	1,
	2;
</code></pre>
<p><img src="https://i.imgur.com/toTSazY.png" alt="" /></p>

<h3 id="d-ì¸ë±ì‹±ìœ¼ë¡œ-ì‹œê³„ì—´-ë°ì´í„°-ë³€í™”-ì´í•´í•˜ê¸°">D. ì¸ë±ì‹±ìœ¼ë¡œ ì‹œê³„ì—´ ë°ì´í„° ë³€í™” ì´í•´í•˜ê¸°</h3>
<p>ë°ì´í„° ì¸ë±ì‹±ì€ ì‹œê³„ì—´ì—ì„œ ë² ì´ìŠ¤ êµ¬ê°„(ì‹œì‘ ì§€ì )ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ì˜ ë³€í™”ëŸ‰ì„ ì´í•´í•˜ëŠ” ë°©ë²•.
ì§‘ê³„í•¨ìˆ˜ì™€ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì¡°í•©í•˜ê±°ë‚˜ self-joinì„ í™œìš©í•¨. ìœˆë„ìš° í•¨ìˆ˜ê°€ ë§¤ìš° ìœ ì—°í•œ ì‚¬ìš©ì„±ì„ ë³´ì´ê¸°ì—, ì´ì— ìµìˆ™í•´ì§€ëŠ”ê²Œ ì¢‹ë‹¤.</p>

<pre><code class="language-sql">SELECT
	sales_year,
	sales,
	first_value(sales) OVER (ORDER BY sales_year) AS index_sales
FROM (
	SELECT
		year(sales_month) AS sales_year,
		sum(sales) AS sales
	FROM
		retail_sales
	WHERE
		kind_of_business in('Women''s clothing stores')
	GROUP BY
		1) a
</code></pre>
<p><img src="https://i.imgur.com/KhhUWJk.png" alt="" /></p>

<h4 id="d1-ìœˆë„ìš°-í•¨ìˆ˜ë¥¼-í™œìš©í•œ-ì¸ë±ì‹±">D.1. ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš©í•œ ì¸ë±ì‹±</h4>
<pre><code class="language-sql">SELECT
	sales_year,
	sales,
	(sales / FIRST_VALUE(sales) OVER (ORDER BY sales_year) - 1) * 100 AS index_sales
FROM (
	SELECT
		year(sales_month) AS sales_year,
		sum(sales) AS sales
	FROM
		retail_sales
	WHERE
		kind_of_business in('Women''s clothing stores')
	GROUP BY
		1) a
</code></pre>

<h2 id="ì‹œê³„ì—´-ë¶„ì„---ì‹œê°„-ìœˆë„ìš°-ë¡¤ë§">ì‹œê³„ì—´ ë¶„ì„ - ì‹œê°„ ìœˆë„ìš° ë¡¤ë§</h2>
<p>ì§‘ê³„ì™€ëŠ” ë˜ ë‹¤ë¥¸ ë…¸ì´ì¦ˆ ì œê±° ë°©ë²•. ì—¬ëŸ¬ êµ¬ê°„ì„ ì„¤ì •í•´ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•˜ëŠ” ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ (=ì´ë™ ê³„ì‚°)
ì‹œê³„ì—´ ë¡¤ë§ ê³„ì‚°ì˜ ìš”ì†ŒëŠ” 3ê°€ì§€. 1) ìœˆë„ìš° ì‚¬ì´ì¦ˆ, 2) ì§‘ê³„ í•¨ìˆ˜, 3) ìœˆë„ìš° ë‚´ ë°ì´í„°ì˜ ë¶„í•  í˜¹ì€ ê·¸ë£¹í™”
ì…€í”„ì¡°ì¸ê³¼ ìœˆë„ìš° í•¨ìˆ˜ë¥¼ í™œìš©</p>

<h3 id="a-ì‹œê°„-ìœˆë„ìš°-ë¡¤ë§-ëˆ„ì -í•©">A. ì‹œê°„ ìœˆë„ìš° ë¡¤ë§ ëˆ„ì  í•©</h3>
<pre><code class="language-sql">SELECT
	a.sales_month,
	a.sales,
	b.sales_month AS rolling_sales_month,
	b.sales AS rolling_sales
FROM
	retail_sales a
	JOIN retail_sales b ON a.kind_of_business = b.kind_of_business
		AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 MONTH)
		AND a.sales_month
		AND b.kind_of_business = 'Women''s clothing stores'
WHERE
	a.kind_of_business = 'Women''s clothing stores'
	AND a.sales_month = date('2019-12-01')
</code></pre>

<p><img src="https://i.imgur.com/bhW2Rzo.png" alt="" /></p>

<h3 id="b-ì´ë™í‰ê· ì„ ">B. ì´ë™í‰ê· ì„ </h3>
<h4 id="b1-self-join">B.1. self join</h4>
<pre><code class="language-sql">SELECT
	a.sales_month,
	a.sales,
	avg(b.sales) AS ma_1y,
	count(b.sales) AS records
FROM
	retail_sales a
	JOIN retail_sales b ON a.kind_of_business = b.kind_of_business
		AND b.sales_month BETWEEN date_sub(a.sales_month, interval 11 month)
		AND a.sales_month
		AND b.kind_of_business = 'Women''s clothing stores'
WHERE
	a.kind_of_business = 'Women''s clothing stores'
	AND a.sales_month &gt;= '1993-01-01'
GROUP BY
	1,
	2
ORDER BY
	1
</code></pre>
<h4 id="b2-frame-ë¬¸ë²•">B.2. Frame ë¬¸ë²•</h4>
<p>frameì ˆì€ ìœˆë„ìš° í•¨ìˆ˜ ì˜µì…˜ì„ í™œìš©í•´, ê° ìœˆë„ìš°ì—ì„œ ì–´ë–¤ ë ˆì½”ë“œë¥¼ í¬í•¨í• ì§€ ì§€ì •í•˜ëŠ” ë¬¸ë²•</p>
<ul>
  <li>frame_endëŠ” ì•„ë˜ ì¤‘ í•˜ë‚˜
    <ul>
      <li>UNBOUNDED PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ ëª¨ë“  í–‰</li>
      <li>offset PRECEDING - í˜„ì¬ í–‰ ì´ì „ì˜ nê°œ í–‰</li>
      <li>CURRENT ROW - í˜„ì¬ í–‰</li>
      <li>offset FOLLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ nê°œ í–‰</li>
      <li>UNBOUNDED FOLOWING - í˜„ì¬ í–‰ ì´í›„ì˜ ëª¨ë“  í–‰</li>
    </ul>
  </li>
</ul>

<pre><code class="language-sql">{range | row | group} BETWEEN frame_start AND frame_end
</code></pre>

<pre><code class="language-sql">SELECT
	sales_month,
	avg(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS moving_avg,
	COUNT(sales) OVER (ORDER BY sales_month ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS records
FROM
	retail_sales
WHERE
	kind_of_business = 'Women''s clothing stores'
</code></pre>

<h3 id="c-í¬ì†Œ-ë°ì´í„°ì˜-ì‹œê°„-ìœˆë„ìš°-ë¡¤ë§">C. í¬ì†Œ ë°ì´í„°ì˜ ì‹œê°„ ìœˆë„ìš° ë¡¤ë§</h3>
<p>ë‚ ì§œ ë£©ì—… í…Œì´ë¸” ì°¸ì¡°í•˜ì—¬ ì¿¼ë¦¬</p>

<pre><code class="language-sql">SELECT d.date,
avg(s.sales) AS moving_average,
count(s.sales) AS records,
max(
	CASE WHEN d.date = s.sales_month THEN
		s.sales
	END) AS sales_in_month
FROM
	date_dim d
	JOIN (
		SELECT
			sales_month,
			sales
		FROM
			retail_sales
		WHERE
			kind_of_business = 'Women''s clothing stores'
			AND month(sales_month)
			IN(1, 7)) s ON s.sales_month BETWEEN DATE_SUB(d.date, INTERVAL 11 MONTH)
	AND d.date
WHERE
	d.date = d.first_day_of_month
	AND d.date BETWEEN '1993-01-01'
	AND '2020-12-01'
GROUP BY
	1
ORDER BY
	1
</code></pre>
<p><img src="https://i.imgur.com/1o0SgBj.png" alt="" /></p>

<h3 id="d-ëˆ„ì ê°’ê°’-ê³„ì‚°">D. ëˆ„ì ê°’ê°’ ê³„ì‚°</h3>
<h4 id="d1-ytd-ìœˆë„ìš°-ë¡¤ë§">D.1. YTD ìœˆë„ìš° ë¡¤ë§</h4>
<pre><code class="language-sql">SELECT
	sales_month,
	sales,
	sum(sales) OVER (PARTITION BY year(sales_month)
		ORDER BY
			sales_month) AS sales_ytd
	FROM
		retail_sales
	WHERE
		kind_of_business = 'Women''s clothing stores'
	ORDER BY
		1
</code></pre>
<h4 id="d2-ytd-ì„œë¸Œì¿¼ë¦¬">D.2. YTD ì„œë¸Œì¿¼ë¦¬</h4>
<pre><code class="language-sql">SELECT
	a.sales_month,
	a.sales,
	sum(b.sales) AS YTD_sales
FROM
	retail_sales a
	JOIN retail_sales b ON year(a.sales_month) = year(b.sales_month)
		AND b.sales_month &lt;= a.sales_month
		AND b.kind_of_business = 'Women''s clothing stores'
WHERE
	a.kind_of_business = 'Women''s clothing stores'
GROUP BY
	1,
	2
ORDER BY
	1
</code></pre>
<p><img src="https://i.imgur.com/Ezthip4.png" alt="" /></p>

<h3 id="e-ê³„ì ˆì„±-ë¶„ì„">E. ê³„ì ˆì„± ë¶„ì„</h3>
<p>ì¼ì •í•œ ê°„ê²©ì„ ë‘ê³  ê·œì¹™ì ìœ¼ë¡œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ ì˜ë¯¸. ì—°ë‹¨ìœ„, í˜¹ì€ ë¶„ë‹¨ìœ„ë¡œ ë‚˜íƒ€ë‚˜ê¸°ë„ í•¨.</p>

<h4 id="e1-lag-í•¨ìˆ˜ë¥¼-ì‚¬ìš©í•œ-ì´ì „ê°’-ëŒ€ë¹„-ë¹„ìœ¨-ë³€í™”">E.1. lag í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì´ì „ê°’ ëŒ€ë¹„ ë¹„ìœ¨ ë³€í™”</h4>
<ul>
  <li>lag í•¨ìˆ˜ëŠ” ì´ì „í–‰ì˜ ê°’ì„ ë°˜í™˜í•œë‹¤. (lead = lagì™€ ë°˜ëŒ€. ë‹¤ìŒ í–‰ì„ ë°˜í™˜)</li>
  <li>offset ì˜µì…˜ : ëª‡ í–‰ ì´ì „ì˜ ê°’ì„ ë°˜í™˜í•  ê²ƒì¸ê°€?</li>
  <li>default ì˜µì…˜ : ì´ì „ í–‰ì´ ì—†ëŠ” ê²½ìš°ì— ë°˜í™˜í•  ê°’</li>
  <li>PARTITION BY ì˜µì…˜ : ìƒëµ ì‹œ, ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•œ ê³„ì‚° ìˆ˜í–‰</li>
  <li>ORDER BY ì˜µì…˜ : ìƒëµ ì‹œ, í˜„ì¬ db ì •ë ¬ ìˆœì„œë¡œ ê³„ì‚° ìˆ˜í–‰</li>
</ul>

<p>êµ¬ê°„ë‹¨ìœ„ ê³„ì‚°ì€ ë³€í™”ë¥¼ ì´í•´í•˜ëŠ”ë° í™œìš©ë¨. ê³„ì ˆì„± ë¶„ì„í•˜ê¸°ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŒ.</p>
<pre><code class="language-sql">SELECT
	kind_of_business,
	sales_month,
	sales,
	lag(sales) OVER (
				PARTITION BY kind_of_business ORDER BY sales_month
				) AS t,
	(sales / (lag(sales) OVER (PARTITION BY kind_of_business ORDER BY sales_month)) - 1) * 100 AS pct_growth_then_prev
FROM
	retail_sales
WHERE
	kind_of_business LIKE 'Book%'
</code></pre>
<p><img src="https://i.imgur.com/IXn0FVY.png" alt="" /></p>

<h4 id="e2-êµ¬ê°„-ë¹„êµ--ì‘ë…„-ë™ì›”ê³¼ì˜-ë¹„êµ">E.2. êµ¬ê°„ ë¹„êµ : ì‘ë…„ ë™ì›”ê³¼ì˜ ë¹„êµ</h4>
<p>ì „ë…„ëŒ€ë¹„ ì„±ì¥ì„¸ë¥¼ ë¹„êµ.</p>
<pre><code class="language-sql">SELECT
	sales_month,
	sales,
	lag(sales_month) OVER (PARTITION BY month(sales_month)
		ORDER BY
			sales_month) AS prev_month,
		lag(sales) OVER (PARTITION BY month(sales_month)
			ORDER BY
				sales_month) AS prev_sales,
			100 * (sales / (lag(sales) OVER (PARTITION BY month(sales_month)
						ORDER BY
							sales_month)) - 1) AS prev_pct
			FROM
				retail_sales
			WHERE
				kind_of_business LIKE 'Book%'
</code></pre>
<p><img src="https://i.imgur.com/yudq1BO.png" alt="" /></p>

<h4 id="e3-êµ¬ê°„-ë¹„êµ--ë™ì›”-ë¹„êµ-ì—°ë„ë³„-ì»¬ëŸ¼-í”¼ë²—">E.3. êµ¬ê°„ ë¹„êµ : ë™ì›” ë¹„êµ. ì—°ë„ë³„ ì»¬ëŸ¼ í”¼ë²—</h4>
<p>ê° ì—°ë„ë³„ ì‹œê°ì  ë¹„êµì— ìš©ì´í•œ í”¼ë²—</p>
<pre><code class="language-sql">SELECT
	month(sales_month) as month_num, 
	monthname(sales_month) as month_char,
	max(case when year(sales_month) = 1992 then sales end) as '1992 sales',
	max(case when year(sales_month) = 1993 then sales end) as '1993 sales',
	max(case when year(sales_month) = 1994 then sales end) as '1994 sales'
FROM
	retail_sales
WHERE
	kind_of_business like 'book%'
	and sales_month between date('1992-01-01') and date('1994-12-01')
group by 1,2
</code></pre>
<p><img src="https://i.imgur.com/wWgAwJu.png" alt="" /></p>

<h4 id="e4-ë‹¤ì¤‘êµ¬ê°„-ë¹„êµ-ì„œë¸Œì¿¼ë¦¬">E.4. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ ì„œë¸Œì¿¼ë¦¬</h4>
<p>ê³„ì‚°ì— í•˜ë‚˜ì˜ í–‰ì´ë¼ë„ null ì´ë©´ nullë¡œ ì²˜ë¦¬ë¨ì„ ìœ ì˜.</p>
<pre><code class="language-sql">SELECT
	sales_month,sales,
	sales/((a.prev_sales_1 + prev_sales_2 + prev_sales_3)/3) * 100 as pct
FROM
	(
		SELECT
			sales_month,
			sales,
			lag(sales,1) over (partition by month(sales_month) 
							   order by sales_month
							  ) as prev_sales_1,
			lag(sales,2) over (partition by month(sales_month) 
							   order by sales_month
							  ) as prev_sales_2,
			lag(sales,3) over (partition by month(sales_month) 
							   order by sales_month
							  ) as prev_sales_3

		FROM
			retail_sales
		WHERE
			kind_of_business like 'Book%'
	) as a
</code></pre>
<p><img src="https://i.imgur.com/pnA9PKv.png" alt="" /></p>

<h4 id="e5-ë‹¤ì¤‘êµ¬ê°„-ë¹„êµ-í”„ë ˆì„ì ˆ">E.5. ë‹¤ì¤‘êµ¬ê°„ ë¹„êµ í”„ë ˆì„ì ˆ</h4>
<p>ì„œë¸Œì¿¼ë¦¬ì™€ ê²°ê³¼ëŠ” ê°™ìœ¼ë‚˜, 1ê°œë¼ë„ nullì´ ì•„ë‹ˆë¼ë©´ ê³„ì‚° ìˆ˜í–‰ë¨ì„ ìœ ì˜</p>
<pre><code class="language-sql">SELECT
	sales_month,
	sales,
	sales / avg(sales) OVER (PARTITION BY month(sales_month)
		ORDER BY
			sales_month ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) AS pct_pre
	FROM
		retail_sales
	WHERE
		kind_of_business LIKE 'Book%'

</code></pre>
<p><img src="https://i.imgur.com/TWZIIIl.png" alt="" /></p>

  </div>
</article>
<!-- 

<div id="disqus_thread"></div>
<script>
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://daegikim.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 -->

      </div>
    </div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="footer-heading">
      copyrignt
      <span style="display: inline-block; vertical-align: middle; transform: rotate(180deg)">&copy;</span>
      all rights reserved
    </div>
    <a href="https://github.com/skadudd"><i class="icon ion-logo-github"></i></a>
    <!-- <a href="https://www.linkedin.com/in/daegi-kim-6b23045b"><i class="icon ion-logo-linkedin"></i></a> -->
    <a href="https://www.instagram.com/naamyoung/"><i class="icon ion-logo-instagram"></i></a>
  </div>
</footer>

  </body>
</html>